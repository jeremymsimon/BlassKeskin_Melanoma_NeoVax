[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Blass & Keskin (2025): Melanoma NeoVax analysis: IFNg single-cell RNAseq",
    "section": "",
    "text": "Introduction\nThis is a book that contains all code to reproduce figures related to scRNAseq analysis of IFNg data associated with Blass & Keskin, et al (2025)\nNote that while the code is identical, this book was rendered after final manuscript figures were generated and thus minor differences may arise, particularly for steps that are non-deterministic or rely on random number generators."
  },
  {
    "objectID": "index.html#enhanced-adjuvanticity-of-a-personal-neoantigen-vaccine-generates-potent-immunity-in-melanoma",
    "href": "index.html#enhanced-adjuvanticity-of-a-personal-neoantigen-vaccine-generates-potent-immunity-in-melanoma",
    "title": "Blass & Keskin (2025): Melanoma NeoVax analysis: IFNg single-cell RNAseq",
    "section": "Enhanced adjuvanticity of a personal neoantigen vaccine generates potent immunity in melanoma",
    "text": "Enhanced adjuvanticity of a personal neoantigen vaccine generates potent immunity in melanoma\nEryn Blass, Derin B. Keskin, Chloe R. Tu, Cleo Forman, Allison Vanasse, Haley E. Sax, Bohoon Shim, Vipheaviny Chea, Nawoo Kim, Isabel Carulli, Jackson Southard, Haoxiang Lyu, Wesley Lu, Micah Rickles-Young, Alexander B. Afeyan, Oriol Olive, Ambica Mehndiratta, Haley Greenslade, Keerthi Shetty, Joanna Baginska, Ilana Gomez-Diaz, Allison Nau, Kathleen L. Pfaff, Andrew Gans, Elizabeth I Buchbinder, Tamara A. Sussman, Megan L Insco, Charles H. Yoon, Scott J. Rodig, Sachet A. Shukla, Shuqiang Li, Jon C. Aster, David A. Braun, Carrie Cibulskis, Nir Hacohen, Donna S. Neuberg, A Giobbie-Hurder, Kenneth J. Livak, Edward F. Fritsch, Giacomo Oliveira, Jeremy M. Simon, Catherine J. Wu, Patrick A. Ott\n\nAbstract\nPersonalized neoantigen-targeting vaccines have great promise, but current delivery strategies are suboptimal. Since antigen availability and effective T cell priming are critical for maximal immunogenicity, we tested a synthetic long peptide vaccine formulated with Montanide, poly-ICLC, and locally administered ipilimumab in addition to systemic nivolumab in 10 patients with melanoma. These personalized vaccines generated de novo ex vivo T cell responses against the majority of immunizing neoepitopes in all 9 fully vaccinated patients, and ex vivo CD8+ T cell responses in 6 of 9. Vaccination induced hundreds of circulating and intratumoral T cell receptor (TCR) clonotypes that were distinct from those arising after PD-1 inhibition. By linking the vaccine neoantigen specificity of T cell clonotypes with single cell phenotypes in tumors, we demonstrate remodeling of the intratumoral T cell repertoire following vaccination. These observations show that multi-pronged immune adjuvanticity can boost T cell responses to neoantigen-targeting vaccines"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#set-up-seurat-workspace",
    "href": "IFNg_scRNA_Part1.html#set-up-seurat-workspace",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.1 Set up Seurat workspace",
    "text": "1.1 Set up Seurat workspace\n\n# Load libraries\nlibrary(data.table)\nlibrary(sctransform)\nlibrary(Seurat)\nlibrary(tidyverse)\nlibrary(miQC)\nlibrary(SeuratWrappers)\nlibrary(fishpond)\nlibrary(Matrix)\nlibrary(patchwork)\nlibrary(alevinQC)\nlibrary(harmony)\nlibrary(scDblFinder)\n\n# Set global options for Seurat v5 objects\noptions(Seurat.object.assay.version = 'v5')"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#load-alevin-fry-output",
    "href": "IFNg_scRNA_Part1.html#load-alevin-fry-output",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.2 Load alevin-fry output",
    "text": "1.2 Load alevin-fry output\nUsing U+S+A counts via snRNA\n\nP108_IFNg_PostVax_5mgIpi_RNA &lt;- loadFry(fryDir =  \"/jsimonlab/projects/Wu/Melanoma_scRNA_Eryn/alevinfry_072023/P108_IFNg_PostVax_5mgIpi_RNA_alevin_quant_crlikeem/\", outputFormat = \"snRNA\")\n\nlocating quant file\n\n\nReading meta data\n\n\nUSA mode: TRUE\n\n\nProcessing 62703 genes and 93474 barcodes\n\n\nUsing pre-defined output format: snrna\n\n\nBuilding the 'counts' assay, which contains U S A\n\n\nConstructing output SingleCellExperiment object\n\n\nDone\n\nP103_IFNg_PostVax_2.5mgIpi_RNA &lt;- loadFry(fryDir =  \"/jsimonlab/projects/Wu/Melanoma_scRNA_Eryn/alevinfry_072023/P103_IFNg_PostVax_2.5mgIpi_RNA_alevin_quant_crlikeem/\", outputFormat = \"snRNA\")\n\nlocating quant file\n\n\nReading meta data\n\n\nUSA mode: TRUE\n\n\nProcessing 62703 genes and 101283 barcodes\n\n\nUsing pre-defined output format: snrna\n\n\nBuilding the 'counts' assay, which contains U S A\n\n\nConstructing output SingleCellExperiment object\n\n\nDone\n\nP101_IFNg_PostVax_2.5mgIpi_RNA &lt;- loadFry(fryDir =  \"/jsimonlab/projects/Wu/Melanoma_scRNA_Eryn/alevinfry_072023/P101_IFNg_PostVax_2.5mgIpi_RNA_alevin_quant_crlikeem/\", outputFormat = \"snRNA\")\n\nlocating quant file\n\n\nReading meta data\n\n\nUSA mode: TRUE\n\n\nProcessing 62703 genes and 75687 barcodes\n\n\nUsing pre-defined output format: snrna\n\n\nBuilding the 'counts' assay, which contains U S A\n\n\nConstructing output SingleCellExperiment object\n\n\nDone\n\nP104_IFNg_PostVax_2.5mgIpi_RNA &lt;- loadFry(fryDir =  \"/jsimonlab/projects/Wu/Melanoma_scRNA_Eryn/alevinfry_072023/P104_IFNg_PostVax_2.5mgIpi_RNA_alevin_quant_crlikeem/\", outputFormat = \"snRNA\")\n\nlocating quant file\n\n\nReading meta data\n\n\nUSA mode: TRUE\n\n\nProcessing 62703 genes and 120627 barcodes\n\n\nUsing pre-defined output format: snrna\n\n\nBuilding the 'counts' assay, which contains U S A\n\n\nConstructing output SingleCellExperiment object\n\n\nDone"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#convert-gene-ids-to-gene-symbols-collapse-transcripts-to-gene-symbols",
    "href": "IFNg_scRNA_Part1.html#convert-gene-ids-to-gene-symbols-collapse-transcripts-to-gene-symbols",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.3 Convert gene IDs to gene symbols, collapse transcripts to gene symbols",
    "text": "1.3 Convert gene IDs to gene symbols, collapse transcripts to gene symbols\n\ntx2gene &lt;- read.table(\"/jsimonlab/genomes/hg38/gencode.v43.annotation_splici/gene_id_to_name.tsv\",header=F,sep=\"\\t\",col.names=c(\"tx\",\"gene\"))\n\n# Use rownames of first object to apply to all\nexp.txId &lt;- rownames(P108_IFNg_PostVax_5mgIpi_RNA)\nexp.geneId &lt;- as.vector(tx2gene$gene[match(exp.txId, tx2gene$tx)])\nexp.tx.grp &lt;- t(sparse.model.matrix(~ 0 + exp.geneId))\n\nP108_IFNg_PostVax_5mgIpi_RNA.summarized &lt;- exp.tx.grp %*% counts(P108_IFNg_PostVax_5mgIpi_RNA)\nrownames(P108_IFNg_PostVax_5mgIpi_RNA.summarized) &lt;- rownames(P108_IFNg_PostVax_5mgIpi_RNA.summarized) %&gt;% str_replace_all(\".+.geneId\",\"\")\n\nP103_IFNg_PostVax_2.5mgIpi_RNA.summarized &lt;- exp.tx.grp %*% counts(P103_IFNg_PostVax_2.5mgIpi_RNA)\nrownames(P103_IFNg_PostVax_2.5mgIpi_RNA.summarized) &lt;- rownames(P103_IFNg_PostVax_2.5mgIpi_RNA.summarized) %&gt;% str_replace_all(\".+.geneId\",\"\")\n\nP101_IFNg_PostVax_2.5mgIpi_RNA.summarized &lt;- exp.tx.grp %*% counts(P101_IFNg_PostVax_2.5mgIpi_RNA)\nrownames(P101_IFNg_PostVax_2.5mgIpi_RNA.summarized) &lt;- rownames(P101_IFNg_PostVax_2.5mgIpi_RNA.summarized) %&gt;% str_replace_all(\".+.geneId\",\"\")\n\nP104_IFNg_PostVax_2.5mgIpi_RNA.summarized &lt;- exp.tx.grp %*% counts(P104_IFNg_PostVax_2.5mgIpi_RNA)\nrownames(P104_IFNg_PostVax_2.5mgIpi_RNA.summarized) &lt;- rownames(P104_IFNg_PostVax_2.5mgIpi_RNA.summarized) %&gt;% str_replace_all(\".+.geneId\",\"\")"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#create-seurat-objects",
    "href": "IFNg_scRNA_Part1.html#create-seurat-objects",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.4 Create Seurat objects",
    "text": "1.4 Create Seurat objects\n\nP108_IFNg_PostVax_5mgIpi_RNA.seurat &lt;- CreateSeuratObject(P108_IFNg_PostVax_5mgIpi_RNA.summarized)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes\n('-')\n\nP103_IFNg_PostVax_2.5mgIpi_RNA.seurat &lt;- CreateSeuratObject(P103_IFNg_PostVax_2.5mgIpi_RNA.summarized)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes\n('-')\n\nP101_IFNg_PostVax_2.5mgIpi_RNA.seurat &lt;- CreateSeuratObject(P101_IFNg_PostVax_2.5mgIpi_RNA.summarized)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes\n('-')\n\nP104_IFNg_PostVax_2.5mgIpi_RNA.seurat &lt;- CreateSeuratObject(P104_IFNg_PostVax_2.5mgIpi_RNA.summarized)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes\n('-')"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#add-sample-name-prefix-to-cbs",
    "href": "IFNg_scRNA_Part1.html#add-sample-name-prefix-to-cbs",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.5 Add sample name prefix to CBs",
    "text": "1.5 Add sample name prefix to CBs\n\nP108_IFNg_PostVax_5mgIpi_RNA.seurat &lt;- RenameCells(P108_IFNg_PostVax_5mgIpi_RNA.seurat,add.cell.id = \"P108_IFNg_PostVax_5mgIpi_RNA\")\nP103_IFNg_PostVax_2.5mgIpi_RNA.seurat &lt;- RenameCells(P103_IFNg_PostVax_2.5mgIpi_RNA.seurat,add.cell.id = \"P103_IFNg_PostVax_2.5mgIpi_RNA\")\nP101_IFNg_PostVax_2.5mgIpi_RNA.seurat &lt;- RenameCells(P101_IFNg_PostVax_2.5mgIpi_RNA.seurat,add.cell.id = \"P101_IFNg_PostVax_2.5mgIpi_RNA\")\nP104_IFNg_PostVax_2.5mgIpi_RNA.seurat &lt;- RenameCells(P104_IFNg_PostVax_2.5mgIpi_RNA.seurat,add.cell.id = \"P104_IFNg_PostVax_2.5mgIpi_RNA\")"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#merge-objects",
    "href": "IFNg_scRNA_Part1.html#merge-objects",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.6 Merge objects",
    "text": "1.6 Merge objects\n\nmerged.18279 &lt;- merge(x = P108_IFNg_PostVax_5mgIpi_RNA.seurat, y=c(P103_IFNg_PostVax_2.5mgIpi_RNA.seurat, P101_IFNg_PostVax_2.5mgIpi_RNA.seurat, P104_IFNg_PostVax_2.5mgIpi_RNA.seurat))\ndim(merged.18279)\n\n[1]  61217 391071"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#qc-filter",
    "href": "IFNg_scRNA_Part1.html#qc-filter",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.7 QC filter",
    "text": "1.7 QC filter\nUse relatively loose initial filters\n\nmerged.18279 &lt;- subset(merged.18279, subset = nCount_RNA &gt; 1000 & nFeature_RNA &gt; 500)\ndim(merged.18279)\n\n[1] 61217 13980\n\nmerged.18279 &lt;- PercentageFeatureSet(merged.18279, pattern = \"^MT-\", col.name = \"percent.mt\")\nmerged.18279 &lt;- RunMiQC(merged.18279, \n                        percent.mt = \"percent.mt\", \n                        nFeature_RNA = \"nFeature_RNA\", \n                        posterior.cutoff = 0.7, \n                        model.slot = \"flexmix_model\")\n\nWarning: Adding a command log without an assay associated with it\n\nmerged.18279 &lt;- subset(merged.18279, miQC.keep == \"keep\")\n\ndim(merged.18279)\n\n[1] 61217 12057\n\ndata.frame(table(str_replace_all(colnames(merged.18279),\"_RNA_.+\",\"\")))\n\n                        Var1 Freq\n1 P101_IFNg_PostVax_2.5mgIpi 3200\n2 P103_IFNg_PostVax_2.5mgIpi 1271\n3 P104_IFNg_PostVax_2.5mgIpi 3303\n4   P108_IFNg_PostVax_5mgIpi 4283"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#add-meta-data",
    "href": "IFNg_scRNA_Part1.html#add-meta-data",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.8 Add meta data",
    "text": "1.8 Add meta data\n\npatient &lt;- str_split_i(colnames(merged.18279),\"_\",1)\nsite &lt;- str_split_i(colnames(merged.18279),\"_\",2)\ntimepoint &lt;- str_split_i(colnames(merged.18279),\"_\",3)\nIpiCohort &lt;- str_split_i(colnames(merged.18279),\"_\",4)\nassay &lt;- str_split_i(colnames(merged.18279),\"_\",5)\nbarcode &lt;- str_split_i(colnames(merged.18279),\"_\",6)\nsample &lt;- paste0(patient,\"_\",site,\"_\",timepoint,\"_\",IpiCohort,\"_\",assay)\n\nmerged.18279 &lt;- AddMetaData(merged.18279,patient,col.name=\"Patient\")\nmerged.18279 &lt;- AddMetaData(merged.18279,site,col.name=\"Site\")\nmerged.18279 &lt;- AddMetaData(merged.18279,timepoint,col.name=\"Timepoint\")\nmerged.18279 &lt;- AddMetaData(merged.18279,IpiCohort,col.name=\"IpiCohort\")\nmerged.18279 &lt;- AddMetaData(merged.18279,assay,col.name=\"Assay\")\nmerged.18279 &lt;- AddMetaData(merged.18279,sample,col.name=\"Sample\")"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#join-then-re-split-rna-counts-layers-by-sample",
    "href": "IFNg_scRNA_Part1.html#join-then-re-split-rna-counts-layers-by-sample",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.9 Join then re-split RNA counts layers by Sample",
    "text": "1.9 Join then re-split RNA counts layers by Sample\n\nmerged.18279[['RNA']] &lt;- JoinLayers(merged.18279[['RNA']])\nmerged.18279[[\"RNA\"]] &lt;- split(merged.18279[[\"RNA\"]], f = merged.18279$Sample)"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#save-merged-object",
    "href": "IFNg_scRNA_Part1.html#save-merged-object",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.10 Save merged object",
    "text": "1.10 Save merged object\n\nsaveRDS(merged.18279,\"IFNg_scRNA_Part1.rds\")"
  },
  {
    "objectID": "IFNg_scRNA_Part1.html#get-session-info",
    "href": "IFNg_scRNA_Part1.html#get-session-info",
    "title": "1  IFNg: QC & Filtering",
    "section": "1.11 Get session info",
    "text": "1.11 Get session info\n\nsessionInfo()\n\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Rocky Linux 8.10 (Green Obsidian)\n\nMatrix products: default\nBLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.15.so;  LAPACK version 3.9.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: America/New_York\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] scDblFinder_1.14.0          SingleCellExperiment_1.22.0\n [3] SummarizedExperiment_1.30.2 Biobase_2.60.0             \n [5] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n [7] IRanges_2.34.1              S4Vectors_0.38.2           \n [9] BiocGenerics_0.46.0         MatrixGenerics_1.12.3      \n[11] matrixStats_1.2.0           harmony_1.2.0              \n[13] Rcpp_1.0.12                 alevinQC_1.16.1            \n[15] patchwork_1.3.0             Matrix_1.6-4               \n[17] fishpond_2.6.2              SeuratWrappers_0.3.19      \n[19] miQC_1.8.0                  lubridate_1.9.3            \n[21] forcats_1.0.0               stringr_1.5.1              \n[23] dplyr_1.1.4                 purrr_1.0.2                \n[25] readr_2.1.5                 tidyr_1.3.1                \n[27] tibble_3.2.1                ggplot2_3.4.4              \n[29] tidyverse_2.0.0             Seurat_5.1.0               \n[31] SeuratObject_5.0.2          sp_2.1-3                   \n[33] sctransform_0.4.1           data.table_1.15.0          \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] tools_4.3.1               utf8_1.2.4               \n  [7] R6_2.5.1                  DT_0.31                  \n  [9] lazyeval_0.2.2            uwot_0.1.16              \n [11] withr_3.0.0               GGally_2.2.1             \n [13] gridExtra_2.3             progressr_0.14.0         \n [15] cli_3.6.2                 spatstat.explore_3.2-6   \n [17] fastDummies_1.7.3         spatstat.data_3.0-4      \n [19] ggridges_0.5.6            pbapply_1.7-2            \n [21] Rsamtools_2.16.0          R.utils_2.12.3           \n [23] scater_1.28.0             parallelly_1.37.0        \n [25] limma_3.56.2              generics_0.1.3           \n [27] BiocIO_1.10.0             gtools_3.9.5             \n [29] ica_1.0-3                 spatstat.random_3.2-2    \n [31] ggbeeswarm_0.7.2          fansi_1.0.6              \n [33] abind_1.4-5               R.methodsS3_1.8.2        \n [35] lifecycle_1.0.4           yaml_2.3.8               \n [37] edgeR_3.42.4              Rtsne_0.17               \n [39] grid_4.3.1                promises_1.2.1           \n [41] dqrng_0.3.2               crayon_1.5.2             \n [43] shinydashboard_0.7.2      miniUI_0.1.1.1           \n [45] lattice_0.22-5            beachmat_2.16.0          \n [47] cowplot_1.1.3             pillar_1.9.0             \n [49] knitr_1.45                metapod_1.8.0            \n [51] rjson_0.2.21              xgboost_1.7.7.1          \n [53] future.apply_1.11.1       codetools_0.2-19         \n [55] leiden_0.4.3.1            glue_1.7.0               \n [57] remotes_2.4.2.1           vctrs_0.6.5              \n [59] png_0.1-8                 spam_2.10-0              \n [61] gtable_0.3.4              xfun_0.42                \n [63] S4Arrays_1.2.0            mime_0.12                \n [65] survival_3.5-8            statmod_1.5.0            \n [67] bluster_1.10.0            ellipsis_0.3.2           \n [69] fitdistrplus_1.1-11       ROCR_1.0-11              \n [71] nlme_3.1-164              RcppAnnoy_0.0.22         \n [73] irlba_2.3.5.1             vipor_0.4.7              \n [75] KernSmooth_2.23-22        colorspace_2.1-0         \n [77] nnet_7.3-19               tidyselect_1.2.0         \n [79] compiler_4.3.1            BiocNeighbors_1.18.0     \n [81] DelayedArray_0.26.7       plotly_4.10.4            \n [83] rtracklayer_1.60.1        scales_1.3.0             \n [85] lmtest_0.9-40             digest_0.6.34            \n [87] goftest_1.2-3             spatstat.utils_3.0-4     \n [89] rmarkdown_2.25            XVector_0.40.0           \n [91] htmltools_0.5.7           pkgconfig_2.0.3          \n [93] sparseMatrixStats_1.12.2  fastmap_1.1.1            \n [95] rlang_1.1.3               htmlwidgets_1.6.4        \n [97] shiny_1.8.0               DelayedMatrixStats_1.22.6\n [99] farver_2.1.1              zoo_1.8-12               \n[101] jsonlite_1.8.8            BiocParallel_1.34.2      \n[103] R.oo_1.26.0               BiocSingular_1.16.0      \n[105] RCurl_1.98-1.14           magrittr_2.0.3           \n[107] modeltools_0.2-23         scuttle_1.10.3           \n[109] GenomeInfoDbData_1.2.10   dotCall64_1.1-1          \n[111] munsell_0.5.0             viridis_0.6.5            \n[113] reticulate_1.35.0         stringi_1.8.3            \n[115] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[117] plyr_1.8.9                flexmix_2.3-19           \n[119] ggstats_0.5.1             parallel_4.3.1           \n[121] listenv_0.9.1             ggrepel_0.9.5            \n[123] deldir_2.0-2              Biostrings_2.68.1        \n[125] splines_4.3.1             tensor_1.5               \n[127] hms_1.1.3                 locfit_1.5-9.8           \n[129] igraph_2.0.2              spatstat.geom_3.2-8      \n[131] RcppHNSW_0.6.0            reshape2_1.4.4           \n[133] ScaledMatrix_1.8.1        XML_3.99-0.16.1          \n[135] evaluate_0.23             scran_1.28.2             \n[137] BiocManager_1.30.22       tzdb_0.4.0               \n[139] httpuv_1.6.14             RANN_2.6.1               \n[141] polyclip_1.10-6           future_1.33.1            \n[143] scattermore_1.2           rsvd_1.0.5               \n[145] xtable_1.8-4              restfulr_0.0.15          \n[147] svMisc_1.2.3              RSpectra_0.16-1          \n[149] later_1.3.2               viridisLite_0.4.2        \n[151] beeswarm_0.4.0            GenomicAlignments_1.36.0 \n[153] tximport_1.28.0           cluster_2.1.6            \n[155] timechange_0.3.0          globals_0.16.2"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#set-up-seurat-workspace",
    "href": "IFNg_scRNA_Part2.html#set-up-seurat-workspace",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.1 Set up Seurat workspace",
    "text": "2.1 Set up Seurat workspace\n\n# Load libraries\nlibrary(data.table)\nlibrary(sctransform)\nlibrary(Seurat)\nlibrary(tidyverse)\nlibrary(miQC)   \nlibrary(SeuratWrappers)\nlibrary(fishpond)\nlibrary(Matrix)\nlibrary(patchwork)\nlibrary(alevinQC)\nlibrary(harmony)\nlibrary(scDblFinder)\n\n# Set global options for Seurat v5 objects\noptions(Seurat.object.assay.version = 'v5')"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#load-previously-saved-merged-object",
    "href": "IFNg_scRNA_Part2.html#load-previously-saved-merged-object",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.2 Load previously saved merged object",
    "text": "2.2 Load previously saved merged object\n\nmerged.18279 &lt;- readRDS(\"IFNg_scRNA_Part1.rds\")"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#normalize-and-scale-data",
    "href": "IFNg_scRNA_Part2.html#normalize-and-scale-data",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.3 Normalize and scale data",
    "text": "2.3 Normalize and scale data\nRegress out mitochondrial contribution\n\nmerged.18279 &lt;- NormalizeData(merged.18279)\nmerged.18279 &lt;- FindVariableFeatures(merged.18279, \n                                    assay = \"RNA\", \n                                    layer = \"data\", \n                                    selection.method = \"vst\", \n                                    nfeatures = 5000)\nmerged.18279 &lt;- ScaleData(merged.18279, vars.to.regress = \"percent.mt\")"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#run-pca",
    "href": "IFNg_scRNA_Part2.html#run-pca",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.4 Run PCA",
    "text": "2.4 Run PCA\n\nmerged.18279 &lt;- RunPCA(merged.18279, npcs = 200)\n\nPC_ 1 \nPositive:  FABP5, PIM3, TNFRSF9, CD82, TNFRSF4, GNG4, PGAM1, PRDX1, ATP1B3, RAN \n       DUSP4, TNFRSF18, RPS17, NME1-NME2, C1QBP, MIR155HG, NDFIP1, NPM1, RPL7, RANBP1 \n       ID2, SRM, HSP90AB1, HSPE1, PARK7, BACH2, PDCD1, HSPD1, REL, MAP2K3 \nNegative:  IL32, CCL5, PLAAT4, LTB, TMSB4X, GZMA, CD74, PTPRC, PTPRCAP, CORO1A \n       IFITM1, MYL12A, CYBA, CYTIP, ANXA1, IFI6, GIMAP7, CD8A, RNF213, EVL \n       TMSB10, CD8B, LIMD2, SAMHD1, CTSW, ARHGDIB, GIMAP4, ISG15, STAT1, KLF6 \nPC_ 2 \nPositive:  RPL39, TPT1, RPS10, MIF, S100A10, LGALS1, S100A11, S100A6, TMSB10, PGK1 \n       CD7, PLP2, TPI1, GPR183, PCSK1N, TMSB4X, LGALS3, ALDOA, LTB, LSR \n       RPL21P16, RPS10-NUDT3, CCR7, SPOCK2, CAPG, PLEKHA7, RPL36A, ENSG00000255508, UNC119, RPL21 \nNegative:  CD38, ZEB2, ATXN1, CDK6, ELMO1, HLA-DRB5, CBLB, RABGAP1L, HLA-DRA, FUT8 \n       LYST, PARP14, MIR4435-2HG, NEAT1, PRKCB, SIK3, PAM, RNF19A, RUNX2, ANKRD44 \n       MBNL1, RBPJ, TIAM2, ENSG00000288632, ENTPD1, FYN, UTRN, SFMBT2, RNF213, TOX \nPC_ 3 \nPositive:  MALAT1, BTG1, PNRC1, BNIP3L, REL, IL2, PPIAP22, TRIM22, PKIA, RPL21P75 \n       RPL21P119, NINJ1, SLC2A3, LINC01619, RPL23AP42, PCED1B-AS1, ZBTB20, RPL21P16, MAML2, YPEL3 \n       RPL7P9, RPL15P3, HNRNPA1P7, ENSG00000218426, BICDL1, RPL9P7, KLF2, IL7R, ENSG00000280441, P4HA1 \nNegative:  ACTG1, TUBA1B, ACTB, TUBB, PSME2, CORO1A, MCM7, NME1-NME2, MCM5, GINS2 \n       CALR, SLC25A5, DCTPP1, CCT6A, SRM, PA2G4, PRMT1, RAN, HSPE1, HSPD1 \n       RANBP1, DYNLL1, GSTP1, SH3BGRL3, PCNA, DUT, LDHB, NHP2, MCM2, NPM1 \nPC_ 4 \nPositive:  SLC4A10, IFNG-AS1, PHLDA1, GNA15, IFNG, IL4I1, SLAMF1, HIF1A, SATB1, IL2RA \n       LGALS3, SLC2A3, RORA, PGK1, CD40LG, CYTIP, NFAT5, FURIN, BHLHE40, IL12RB2 \n       DPP4, SLC16A3, ANKRD28, SYTL3, TNFAIP3, PFKFB3, NFKBIA, KLRB1, GPR183, IL2RB \nNegative:  IFITM1, RPS4Y1, ISG15, CTSW, CD8B, HLA-DPB1, LY6E, HLA-DPA1, HLA-DRB5, HLA-DRA \n       HLA-DRB1, PLAAT4, OASL, COTL1, CD27, KLRC4-KLRK1, SP110, IFIT3, IFIT1, C12orf57 \n       HLA-DQA1, CD38, CCDC85B, OAS1, LIMD2, CD52, RPS10-NUDT3, IFIT2, HLA-DMA, ISG20 \nPC_ 5 \nPositive:  NOLC1, DDX21, NCL, HSPD1, HNRNPAB, EIF4A1, NOP16, FKBP4, EBNA1BP2, SRM \n       NPM1, TOMM40, C1QBP, SLC4A10, RPS17, PRMT1, NOP56, ODC1, ENSG00000249492, KCNQ5 \n       CCT6A, SATB1, TRAP1, RPL17, DCTPP1, PA2G4, IFNG-AS1, CCT2, HSP90AB1, FEZ1 \nNegative:  SH3BGRL3, C4orf3, S100A10, TPI1, ALDOA, BNIP3L, SIT1, LBH, GPI, IGFLR1 \n       SRGN, CRIP1, GNA15, BNIP3, JUN, LGALS1, MIF, LSP1, CTSB, LDHA \n       LAG3, APOBEC3G, CD82, PGK1, NMB, TMSB4X, SLC16A3, BTG1, PGAM1, CD4 \n\nElbowPlot(merged.18279, ndims = 200, reduction = \"pca\")"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#plot-unintegrated-umap",
    "href": "IFNg_scRNA_Part2.html#plot-unintegrated-umap",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.5 Plot unintegrated UMAP",
    "text": "2.5 Plot unintegrated UMAP\n\nmerged.18279 &lt;- RunUMAP(merged.18279, \n                        reduction = \"pca\", \n                        dims = 1:50, \n                        reduction.name = \"umap.unintegrated\")\n\nWarning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric\nTo use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'\nThis message will be shown once per session\n\n\n15:24:48 UMAP embedding parameters a = 0.9922 b = 1.112\n\n\nFound more than one class \"dist\" in cache; using the first, from namespace 'spam'\n\n\nAlso defined by 'BiocGenerics'\n\n\n15:24:48 Read 12057 rows and found 50 numeric columns\n\n\n15:24:48 Using Annoy for neighbor search, n_neighbors = 30\n\n\nFound more than one class \"dist\" in cache; using the first, from namespace 'spam'\n\n\nAlso defined by 'BiocGenerics'\n\n\n15:24:48 Building Annoy index with metric = cosine, n_trees = 50\n\n\n0%   10   20   30   40   50   60   70   80   90   100%\n\n\n[----|----|----|----|----|----|----|----|----|----|\n\n\n**************************************************|\n15:24:52 Writing NN index file to temp file /tmp/RtmpzlkBZG/file37c5d823da5d58\n15:24:52 Searching Annoy index using 1 thread, search_k = 3000\n15:24:56 Annoy recall = 100%\n15:24:57 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30\n15:25:00 Initializing from normalized Laplacian + noise (using RSpectra)\n15:25:00 Commencing optimization for 200 epochs, with 532572 positive edges\n15:25:09 Optimization finished\n\nDimPlot(merged.18279, reduction = \"umap.unintegrated\", group.by = c(\"Site\", \"Patient\", \"Timepoint\"))"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#call-preliminary-clusters-for-the-purposes-of-doublet-discrimination",
    "href": "IFNg_scRNA_Part2.html#call-preliminary-clusters-for-the-purposes-of-doublet-discrimination",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.6 Call preliminary clusters for the purposes of doublet discrimination",
    "text": "2.6 Call preliminary clusters for the purposes of doublet discrimination\n\nmerged.18279 &lt;- FindNeighbors(merged.18279, dims = 1:50, reduction = \"pca\")\n\nComputing nearest neighbor graph\n\n\nComputing SNN\n\nmerged.18279 &lt;- FindClusters(merged.18279, \n                             resolution = 0.25, \n                             algorithm = 2)\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12057\nNumber of edges: 457888\n\nRunning Louvain algorithm with multilevel refinement...\nMaximum modularity in 10 random starts: 0.9125\nNumber of communities: 8\nElapsed time: 1 seconds\n\nDimPlot(merged.18279, reduction = \"umap.unintegrated\", label = T)"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#identify-and-remove-doublets",
    "href": "IFNg_scRNA_Part2.html#identify-and-remove-doublets",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.7 Identify and remove doublets",
    "text": "2.7 Identify and remove doublets\nThis uses raw counts as input\n\n2.7.1 Combine RNA layers\n\nmerged.18279[['RNA']] &lt;- JoinLayers(merged.18279[['RNA']])\n\n\n\n2.7.2 Convert seurat to sce and check colData\n\nmerged.18279.sce &lt;- as.SingleCellExperiment(merged.18279, assay = \"RNA\")\nmerged.18279.sce\n\nclass: SingleCellExperiment \ndim: 61217 12057 \nmetadata(0):\nassays(2): counts logcounts\nrownames(61217): 5-8S-rRNA 5S-rRNA ... ZZEF1 ZZZ3\nrowData names(0):\ncolnames(12057): P108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG\n  P108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT ...\n  P104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC\n  P104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA\ncolData names(15): orig.ident nCount_RNA ... seurat_clusters ident\nreducedDimNames(2): PCA UMAP.UNINTEGRATED\nmainExpName: RNA\naltExpNames(0):\n\ncolData(merged.18279.sce)\n\nDataFrame with 12057 rows and 15 columns\n                                                   orig.ident nCount_RNA\n                                                  &lt;character&gt;  &lt;numeric&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG   SeuratProject    20129.8\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT   SeuratProject    19535.9\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC   SeuratProject    19411.9\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT   SeuratProject    20429.8\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC   SeuratProject    19299.9\n...                                                       ...        ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT SeuratProject       2048\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT SeuratProject       1499\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT SeuratProject       2483\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC SeuratProject       1177\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA SeuratProject       1471\n                                                nFeature_RNA percent.mt\n                                                   &lt;integer&gt;  &lt;numeric&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG           4947    3.86697\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT           4384    2.45138\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC           4735    2.01548\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT           4958    2.64150\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC           4227    4.15930\n...                                                      ...        ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT          965   4.736328\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT          778   1.667779\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT         1214   0.443012\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC          670   2.378929\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA          900   4.979606\n                                                miQC.probability   miQC.keep\n                                                       &lt;numeric&gt; &lt;character&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG          0.0756333        keep\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT          0.0434632        keep\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC          0.0573548        keep\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT          0.0424527        keep\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC          0.0975392        keep\n...                                                          ...         ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT       0.05033876        keep\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT       0.02237223        keep\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT       0.27941627        keep\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC       0.00989129        keep\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA       0.07598866        keep\n                                                    Patient        Site\n                                                &lt;character&gt; &lt;character&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG          P108        IFNg\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT          P108        IFNg\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC          P108        IFNg\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT          P108        IFNg\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC          P108        IFNg\n...                                                     ...         ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT        P104        IFNg\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT        P104        IFNg\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT        P104        IFNg\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC        P104        IFNg\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA        P104        IFNg\n                                                  Timepoint   IpiCohort\n                                                &lt;character&gt; &lt;character&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG       PostVax      5mgIpi\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT       PostVax      5mgIpi\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC       PostVax      5mgIpi\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT       PostVax      5mgIpi\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC       PostVax      5mgIpi\n...                                                     ...         ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT     PostVax    2.5mgIpi\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT     PostVax    2.5mgIpi\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT     PostVax    2.5mgIpi\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC     PostVax    2.5mgIpi\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA     PostVax    2.5mgIpi\n                                                      Assay\n                                                &lt;character&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG           RNA\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT           RNA\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC           RNA\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT           RNA\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC           RNA\n...                                                     ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT         RNA\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT         RNA\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT         RNA\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC         RNA\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA         RNA\n                                                                Sample\n                                                           &lt;character&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG   P108_IFNg_PostVax_5m..\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT   P108_IFNg_PostVax_5m..\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC   P108_IFNg_PostVax_5m..\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT   P108_IFNg_PostVax_5m..\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC   P108_IFNg_PostVax_5m..\n...                                                                ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT P104_IFNg_PostVax_2...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT P104_IFNg_PostVax_2...\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT P104_IFNg_PostVax_2...\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC P104_IFNg_PostVax_2...\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA P104_IFNg_PostVax_2...\n                                                RNA_snn_res.0.25\n                                                        &lt;factor&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG                  0\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT                  0\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC                  0\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT                  0\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC                  0\n...                                                          ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT                5\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT                1\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT                1\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC                1\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA                1\n                                                seurat_clusters    ident\n                                                       &lt;factor&gt; &lt;factor&gt;\nP108_IFNg_PostVax_5mgIpi_RNA_ACTTACTTCCAAGCCG                 0        0\nP108_IFNg_PostVax_5mgIpi_RNA_GCATACACAAAGGCGT                 0        0\nP108_IFNg_PostVax_5mgIpi_RNA_TGCACCTAGACCCACC                 0        0\nP108_IFNg_PostVax_5mgIpi_RNA_GGATGTTGTCTCTTAT                 0        0\nP108_IFNg_PostVax_5mgIpi_RNA_TGCGGGTAGCATCATC                 0        0\n...                                                         ...      ...\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCTAGCTGTCGTGGCT               5        5\nP104_IFNg_PostVax_2.5mgIpi_RNA_CCCATACAGGTGATAT               1        1\nP104_IFNg_PostVax_2.5mgIpi_RNA_ACTTTCATCACTTCAT               1        1\nP104_IFNg_PostVax_2.5mgIpi_RNA_AGAGTGGGTTATTATC               1        1\nP104_IFNg_PostVax_2.5mgIpi_RNA_TGGTTCCTCGTCTGAA               1        1\n\n\n\n\n2.7.3 Run scDblFinder\nSet the dbr.sd very high to better allow thresholds to be set based on misclassification rates per sample\n\nmerged.18279.sce &lt;- scDblFinder(merged.18279.sce,\n                                 samples = \"Sample\",\n                 dbr.sd = 1,\n                                 clusters = \"seurat_clusters\")\n\n\n\n2.7.4 Inspect results\n\n# Look at the classes\ntable(merged.18279.sce$seurat_clusters, merged.18279.sce$scDblFinder.class)\n\n   \n    singlet doublet\n  0    2911     196\n  1    2220     148\n  2    2095     258\n  3    1249     167\n  4    1212      73\n  5     751      11\n  6     474      27\n  7     253      12\n\ntable(merged.18279.sce$Sample, merged.18279.sce$scDblFinder.class)\n\n                                \n                                 singlet doublet\n  P101_IFNg_PostVax_2.5mgIpi_RNA    2953     247\n  P103_IFNg_PostVax_2.5mgIpi_RNA    1099     172\n  P104_IFNg_PostVax_2.5mgIpi_RNA    3113     190\n  P108_IFNg_PostVax_5mgIpi_RNA      4000     283\n\n# Look at the scores\nsummary(merged.18279.sce$scDblFinder.score)\n\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n0.0000525 0.0023453 0.0098138 0.1059070 0.0527471 0.9999471 \n\n\n\n\n2.7.5 Save doublet classifications into main Seurat object\n\nmerged.18279$doublet_classification &lt;- merged.18279.sce$scDblFinder.class\n\n\n\n2.7.6 Count singlets and doublets\n\ntable(merged.18279$doublet_classification)\n\n\nsinglet doublet \n  11165     892 \n\ntable(merged.18279$doublet_classification, merged.18279$seurat_clusters)\n\n         \n             0    1    2    3    4    5    6    7\n  singlet 2911 2220 2095 1249 1212  751  474  253\n  doublet  196  148  258  167   73   11   27   12\n\n\n\n\n2.7.7 Plot singlets/doublets in UMAP space\n\nDimPlot(merged.18279,reduction = \"umap.unintegrated\", group.by = \"doublet_classification\")\n\n\n\n\n\n\n2.7.8 Subset object to remove doublets and count remaining cells\n\nmerged.18279.singlets &lt;- subset(merged.18279, doublet_classification %in% c(\"singlet\"))\ndim(merged.18279.singlets)\n\n[1] 61217 11165\n\n# Count remaining cells per initial cluster\ntable(merged.18279.singlets$seurat_clusters)\n\n\n   0    1    2    3    4    5    6    7 \n2911 2220 2095 1249 1212  751  474  253"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#remove-cells-with-very-high-ncount_rna-values-set-other-final-qc-filters",
    "href": "IFNg_scRNA_Part2.html#remove-cells-with-very-high-ncount_rna-values-set-other-final-qc-filters",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.8 Remove cells with very high nCount_RNA values, set other final QC filters",
    "text": "2.8 Remove cells with very high nCount_RNA values, set other final QC filters\n\nmerged.18279.singlets &lt;- subset(merged.18279.singlets,\n                                subset = nCount_RNA &lt; 40000 & nCount_RNA &gt; 3000 & nFeature_RNA &gt; 1500)\ndim(merged.18279.singlets)\n\n[1] 61217 10320"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#re-compute-pca",
    "href": "IFNg_scRNA_Part2.html#re-compute-pca",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.9 Re-compute PCA",
    "text": "2.9 Re-compute PCA\nRe-scale data now that it has been subset\n\nmerged.18279.singlets[[\"RNA\"]] &lt;- split(merged.18279.singlets[[\"RNA\"]], f = merged.18279.singlets$Sample)\n\nmerged.18279.singlets &lt;- FindVariableFeatures(merged.18279.singlets, \n                                    assay = \"RNA\", \n                                    layer = \"data\", \n                                    selection.method = \"vst\", \n                                    nfeatures = 5000)\nmerged.18279.singlets &lt;- ScaleData(merged.18279.singlets, vars.to.regress = \"percent.mt\")\nmerged.18279.singlets &lt;- RunPCA(merged.18279.singlets, npcs = 200, verbose = TRUE)"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#run-harmony-integration",
    "href": "IFNg_scRNA_Part2.html#run-harmony-integration",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.10 Run Harmony integration",
    "text": "2.10 Run Harmony integration\n\nmerged.18279.singlets &lt;- IntegrateLayers(merged.18279.singlets, \n                                method = HarmonyIntegration, \n                                orig.reduction = \"pca\",\n                                new.reduction = \"integrated.harmony\"\n)\n\nWarning: HarmonyMatrix is deprecated and will be removed in the future from the\nAPI in the future\n\n\nWarning: Warning: The parameters do_pca and npcs are deprecated. They will be ignored for this function call and please remove parameters do_pca and npcs and pass to harmony cell_embeddings directly.\nThis warning is displayed once per session.\n\n\nWarning: Warning: The parameter tau is deprecated. It will be ignored for this function call and please remove parameter tau in future function calls. Advanced users can set value of parameter tau by using parameter .options and function harmony_options().\nThis warning is displayed once per session.\n\n\nWarning: Warning: The parameter block.size is deprecated. It will be ignored for this function call and please remove parameter block.size in future function calls. Advanced users can set value of parameter block.size by using parameter .options and function harmony_options().\nThis warning is displayed once per session.\n\n\nWarning: Warning: The parameter max.iter.harmony is replaced with parameter max_iter. It will be ignored for this function call and please use parameter max_iter in future function calls.\nThis warning is displayed once per session.\n\n\nWarning: Warning: The parameter max.iter.cluster is deprecated. It will be ignored for this function call and please remove parameter max.iter.cluster in future function calls. Advanced users can set value of parameter max.iter.cluster by using parameter .options and function harmony_options().\nThis warning is displayed once per session.\n\n\nWarning: Warning: The parameter epsilon.cluster is deprecated. It will be ignored for this function call and please remove parameter epsilon.cluster in future function calls. Advanced users can set value of parameter epsilon.cluster by using parameter .options and function harmony_options().\nThis warning is displayed once per session.\n\n\nWarning: Warning: The parameter epsilon.harmony is deprecated. It will be ignored for this function call and please remove parameter epsilon.harmony in future function calls. If users want to control if harmony would stop early or not, use parameter early_stop. Advanced users can set value of parameter epsilon.harmony by using parameter .options and function harmony_options().\nThis warning is displayed once per session.\n\n\nTransposing data matrix\n\n\nUsing automatic lambda estimation\n\n\nInitializing state using k-means centroids initialization\n\n\nHarmony 1/10\n\n\nHarmony 2/10\n\n\nHarmony converged after 2 iterations"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#identify-final-clusters-after-integration",
    "href": "IFNg_scRNA_Part2.html#identify-final-clusters-after-integration",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.11 Identify final clusters after integration",
    "text": "2.11 Identify final clusters after integration\n\nmerged.18279.singlets &lt;- FindNeighbors(merged.18279.singlets, dims = 1:30, reduction = \"integrated.harmony\")\n\nComputing nearest neighbor graph\n\n\nComputing SNN\n\nmerged.18279.singlets &lt;- FindClusters(merged.18279.singlets, \n                             resolution = 0.7, \n                             algorithm = 2)\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 10320\nNumber of edges: 352714\n\nRunning Louvain algorithm with multilevel refinement...\nMaximum modularity in 10 random starts: 0.8127\nNumber of communities: 11\nElapsed time: 1 seconds\n\nmerged.18279.singlets &lt;- RunUMAP(merged.18279.singlets,\n                        reduction = \"integrated.harmony\",\n                        dims = 1:30,\n                        reduction.name = \"umap.harmony\")\n\n15:36:03 UMAP embedding parameters a = 0.9922 b = 1.112\n\n\nFound more than one class \"dist\" in cache; using the first, from namespace 'spam'\n\n\nAlso defined by 'BiocGenerics'\n\n\n15:36:03 Read 10320 rows and found 30 numeric columns\n\n\n15:36:03 Using Annoy for neighbor search, n_neighbors = 30\n\n\nFound more than one class \"dist\" in cache; using the first, from namespace 'spam'\n\n\nAlso defined by 'BiocGenerics'\n\n\n15:36:03 Building Annoy index with metric = cosine, n_trees = 50\n\n\n0%   10   20   30   40   50   60   70   80   90   100%\n\n\n[----|----|----|----|----|----|----|----|----|----|\n\n\n**************************************************|\n15:36:06 Writing NN index file to temp file /tmp/RtmpzlkBZG/file37c5d8437d41b\n15:36:06 Searching Annoy index using 1 thread, search_k = 3000\n15:36:10 Annoy recall = 100%\n15:36:11 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30\n15:36:13 Initializing from normalized Laplacian + noise (using RSpectra)\n15:36:13 Commencing optimization for 200 epochs, with 447378 positive edges\n15:36:21 Optimization finished\n\ntable(merged.18279.singlets$seurat_clusters)\n\n\n   0    1    2    3    4    5    6    7    8    9   10 \n2023 1984 1845 1165 1093  778  470  373  355  130  104"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#plot-clusters",
    "href": "IFNg_scRNA_Part2.html#plot-clusters",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.12 Plot clusters",
    "text": "2.12 Plot clusters\n\nDimPlot(merged.18279.singlets,reduction = \"umap.harmony\", label = TRUE)\n\n\n\nDimPlot(merged.18279.singlets,reduction = \"umap.harmony\", group.by = \"Patient\")\n\n\n\nDimPlot(merged.18279.singlets,reduction = \"umap.harmony\", group.by = \"Site\")\n\n\n\nDimPlot(merged.18279.singlets,reduction = \"umap.harmony\", group.by = \"Timepoint\")\n\n\n\nDimPlot(merged.18279.singlets,reduction = \"umap.harmony\", group.by = \"IpiCohort\")\n\n\n\nDimPlot(merged.18279.singlets,reduction = \"umap.harmony\", group.by = \"Sample\") + NoLegend()"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#save-clustered-object",
    "href": "IFNg_scRNA_Part2.html#save-clustered-object",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.13 Save clustered object",
    "text": "2.13 Save clustered object\n\nsaveRDS(merged.18279.singlets,\"IFNg_scRNA_Part2.rds\")"
  },
  {
    "objectID": "IFNg_scRNA_Part2.html#get-session-info",
    "href": "IFNg_scRNA_Part2.html#get-session-info",
    "title": "2  IFNg: Normalization, doublet discrimination, integration, clustering",
    "section": "2.14 Get session info",
    "text": "2.14 Get session info\n\nsessionInfo()\n\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Rocky Linux 8.10 (Green Obsidian)\n\nMatrix products: default\nBLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.15.so;  LAPACK version 3.9.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: America/New_York\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] scDblFinder_1.14.0          SingleCellExperiment_1.22.0\n [3] SummarizedExperiment_1.30.2 Biobase_2.60.0             \n [5] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n [7] IRanges_2.34.1              S4Vectors_0.38.2           \n [9] BiocGenerics_0.46.0         MatrixGenerics_1.12.3      \n[11] matrixStats_1.2.0           harmony_1.2.0              \n[13] Rcpp_1.0.12                 alevinQC_1.16.1            \n[15] patchwork_1.3.0             Matrix_1.6-4               \n[17] fishpond_2.6.2              SeuratWrappers_0.3.19      \n[19] miQC_1.8.0                  lubridate_1.9.3            \n[21] forcats_1.0.0               stringr_1.5.1              \n[23] dplyr_1.1.4                 purrr_1.0.2                \n[25] readr_2.1.5                 tidyr_1.3.1                \n[27] tibble_3.2.1                ggplot2_3.4.4              \n[29] tidyverse_2.0.0             Seurat_5.1.0               \n[31] SeuratObject_5.0.2          sp_2.1-3                   \n[33] sctransform_0.4.1           data.table_1.15.0          \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] tools_4.3.1               utf8_1.2.4               \n  [7] R6_2.5.1                  DT_0.31                  \n  [9] lazyeval_0.2.2            uwot_0.1.16              \n [11] withr_3.0.0               GGally_2.2.1             \n [13] gridExtra_2.3             progressr_0.14.0         \n [15] cli_3.6.2                 spatstat.explore_3.2-6   \n [17] fastDummies_1.7.3         labeling_0.4.3           \n [19] spatstat.data_3.0-4       ggridges_0.5.6           \n [21] pbapply_1.7-2             Rsamtools_2.16.0         \n [23] R.utils_2.12.3            scater_1.28.0            \n [25] parallelly_1.37.0         limma_3.56.2             \n [27] generics_0.1.3            BiocIO_1.10.0            \n [29] gtools_3.9.5              ica_1.0-3                \n [31] spatstat.random_3.2-2     ggbeeswarm_0.7.2         \n [33] fansi_1.0.6               abind_1.4-5              \n [35] R.methodsS3_1.8.2         lifecycle_1.0.4          \n [37] yaml_2.3.8                edgeR_3.42.4             \n [39] Rtsne_0.17                grid_4.3.1               \n [41] promises_1.2.1            dqrng_0.3.2              \n [43] crayon_1.5.2              shinydashboard_0.7.2     \n [45] miniUI_0.1.1.1            lattice_0.22-5           \n [47] beachmat_2.16.0           cowplot_1.1.3            \n [49] pillar_1.9.0              knitr_1.45               \n [51] metapod_1.8.0             rjson_0.2.21             \n [53] xgboost_1.7.7.1           future.apply_1.11.1      \n [55] codetools_0.2-19          leiden_0.4.3.1           \n [57] glue_1.7.0                remotes_2.4.2.1          \n [59] vctrs_0.6.5               png_0.1-8                \n [61] spam_2.10-0               gtable_0.3.4             \n [63] xfun_0.42                 S4Arrays_1.2.0           \n [65] mime_0.12                 survival_3.5-8           \n [67] statmod_1.5.0             bluster_1.10.0           \n [69] ellipsis_0.3.2            fitdistrplus_1.1-11      \n [71] ROCR_1.0-11               nlme_3.1-164             \n [73] RcppAnnoy_0.0.22          irlba_2.3.5.1            \n [75] vipor_0.4.7               KernSmooth_2.23-22       \n [77] colorspace_2.1-0          nnet_7.3-19              \n [79] tidyselect_1.2.0          compiler_4.3.1           \n [81] BiocNeighbors_1.18.0      DelayedArray_0.26.7      \n [83] plotly_4.10.4             rtracklayer_1.60.1       \n [85] scales_1.3.0              lmtest_0.9-40            \n [87] digest_0.6.34             goftest_1.2-3            \n [89] spatstat.utils_3.0-4      rmarkdown_2.25           \n [91] RhpcBLASctl_0.23-42       XVector_0.40.0           \n [93] htmltools_0.5.7           pkgconfig_2.0.3          \n [95] sparseMatrixStats_1.12.2  fastmap_1.1.1            \n [97] rlang_1.1.3               htmlwidgets_1.6.4        \n [99] shiny_1.8.0               DelayedMatrixStats_1.22.6\n[101] farver_2.1.1              zoo_1.8-12               \n[103] jsonlite_1.8.8            BiocParallel_1.34.2      \n[105] R.oo_1.26.0               BiocSingular_1.16.0      \n[107] RCurl_1.98-1.14           magrittr_2.0.3           \n[109] modeltools_0.2-23         scuttle_1.10.3           \n[111] GenomeInfoDbData_1.2.10   dotCall64_1.1-1          \n[113] munsell_0.5.0             viridis_0.6.5            \n[115] reticulate_1.35.0         stringi_1.8.3            \n[117] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[119] plyr_1.8.9                flexmix_2.3-19           \n[121] ggstats_0.5.1             parallel_4.3.1           \n[123] listenv_0.9.1             ggrepel_0.9.5            \n[125] deldir_2.0-2              Biostrings_2.68.1        \n[127] splines_4.3.1             tensor_1.5               \n[129] hms_1.1.3                 locfit_1.5-9.8           \n[131] igraph_2.0.2              spatstat.geom_3.2-8      \n[133] RcppHNSW_0.6.0            reshape2_1.4.4           \n[135] ScaledMatrix_1.8.1        XML_3.99-0.16.1          \n[137] evaluate_0.23             scran_1.28.2             \n[139] BiocManager_1.30.22       tzdb_0.4.0               \n[141] httpuv_1.6.14             RANN_2.6.1               \n[143] polyclip_1.10-6           future_1.33.1            \n[145] scattermore_1.2           rsvd_1.0.5               \n[147] xtable_1.8-4              restfulr_0.0.15          \n[149] svMisc_1.2.3              RSpectra_0.16-1          \n[151] later_1.3.2               viridisLite_0.4.2        \n[153] beeswarm_0.4.0            GenomicAlignments_1.36.0 \n[155] tximport_1.28.0           cluster_2.1.6            \n[157] timechange_0.3.0          globals_0.16.2"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#set-up-seurat-workspace",
    "href": "IFNg_scRNA_Part3.html#set-up-seurat-workspace",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.1 Set up Seurat workspace",
    "text": "3.1 Set up Seurat workspace\n\n# Load libraries\nlibrary(data.table)\nlibrary(devtools)\nlibrary(presto)\nlibrary(glmGamPoi)\nlibrary(sctransform)\nlibrary(Seurat)\nlibrary(tidyverse)\nlibrary(miQC)  \nlibrary(SeuratWrappers)\nlibrary(flexmix)\nlibrary(SingleCellExperiment)\nlibrary(SummarizedExperiment)\nlibrary(readxl)\nlibrary(fishpond)\nlibrary(Matrix)\nlibrary(speckle)\nlibrary(scater)\nlibrary(patchwork)\nlibrary(vctrs)\nlibrary(alevinQC)\nlibrary(harmony)\nlibrary(scDblFinder)\nlibrary(cellXY)\nlibrary(STACAS)\nlibrary(ProjecTILs)\n\n# Set global options for Seurat v5 objects\noptions(Seurat.object.assay.version = 'v5')"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#load-previously-saved-clustered-object",
    "href": "IFNg_scRNA_Part3.html#load-previously-saved-clustered-object",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.2 Load previously saved clustered object",
    "text": "3.2 Load previously saved clustered object\n\nmerged.18279.singlets &lt;- readRDS(\"IFNg_scRNA_Part2.rds\")"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#run-cd8-and-cd4-projection-with-projectils-as-in-this-vignette",
    "href": "IFNg_scRNA_Part3.html#run-cd8-and-cd4-projection-with-projectils-as-in-this-vignette",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.3 Run CD8 and CD4 projection with projecTILs as in this vignette",
    "text": "3.3 Run CD8 and CD4 projection with projecTILs as in this vignette\nNote these classifications are limited only to CD4/CD8 and do not include NK cells\n\n3.3.1 Retrieve human CD8 and CD4 reference maps\n\noptions(timeout = max(900, getOption(\"timeout\")))\ndownload.file(\"https://figshare.com/ndownloader/files/41414556\", destfile = \"CD8T_human_ref_v1.rds\")\nref.cd8 &lt;- load.reference.map(\"CD8T_human_ref_v1.rds\")\n\n[1] \"Loading Custom Reference Atlas...\"\n[1] \"Loaded Custom Reference map Human CD8 TILs\"\n\ndownload.file(\"https://figshare.com/ndownloader/files/39012395\", destfile = \"CD4T_human_ref_v1.rds\")\nref.cd4 &lt;- load.reference.map(\"CD4T_human_ref_v1.rds\")\n\n[1] \"Loading Custom Reference Atlas...\"\n[1] \"Loaded Custom Reference map custom_reference\"\n\n\n\n\n3.3.2 Plot reference atlases\n\na &lt;- DimPlot(ref.cd8, cols = ref.cd8@misc$atlas.palette, label = T) + theme(aspect.ratio = 1) +\n    ggtitle(\"CD8 T reference\") + NoLegend()\n\nb &lt;- DimPlot(ref.cd4, cols = ref.cd4@misc$atlas.palette, label = T) + theme(aspect.ratio = 1) +\n    ggtitle(\"CD4 T reference\") + NoLegend()\n\na | b\n\n\n\n\n\n\n3.3.3 Classify CD8 T subtypes\n\nmerged.18279.singlets &lt;- ProjecTILs.classifier(merged.18279.singlets, ref.cd8, ncores = 8, split.by = \"Sample\")\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"977 out of 1041 ( 94% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"2362 out of 3000 ( 79% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"1581 out of 2550 ( 62% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"3041 out of 3729 ( 82% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n\n3.3.4 Classify CD4 T subtypes\n\nmerged.18279.singlets &lt;- ProjecTILs.classifier(merged.18279.singlets, ref.cd4, ncores = 8, split.by = \"Sample\", overwrite = F)\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"110 out of 1041 ( 11% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"1170 out of 2550 ( 46% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"914 out of 3000 ( 30% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%[1] \"Using assay RNA for query\"\n[1] \"1100 out of 3729 ( 29% ) non-pure cells removed. Use filter.cells=FALSE to avoid pre-filtering\"\nPerforming log-normalization\n0%   10   20   30   40   50   60   70   80   90   100%\n[----|----|----|----|----|----|----|----|----|----|\n**************************************************|\n[1] \"Aligning query to reference map for batch-correction...\"\n\nProjecting corrected query onto Reference PCA space\n\nProjecting corrected query onto Reference UMAP space\n\n  |                                                                            \n  |======================================================================| 100%"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#tabulate-and-visualize-projections",
    "href": "IFNg_scRNA_Part3.html#tabulate-and-visualize-projections",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.4 Tabulate and visualize projections",
    "text": "3.4 Tabulate and visualize projections\nIn addition to guiding annotation, these projected cell states can be quantified downstream comparing pre vs post-vaccine, tumor samples over time, or to characterize the phenotypes of T-cells that have expanded with vaccination\n\n3.4.1 Count total cells by T cell state\n\ntable(merged.18279.singlets$functional.cluster, useNA = \"ifany\")\n\n\nCD4.CTL_EOMES   CD4.CTL_Exh  CD4.CTL_GNLY CD4.NaiveLike       CD4.Tfh \n          169           307            28           293          1203 \n     CD4.Th17      CD4.Treg        CD8.CM        CD8.EM      CD8.MAIT \n         4854           172           205            76            23 \nCD8.NaiveLike     CD8.TEMRA       CD8.TEX      CD8.TPEX          &lt;NA&gt; \n           30            11          1446           568           935 \n\n\n\n\n3.4.2 Tabulate which T cell state was most abundant in each cluster at 0.7 res\n\nas.data.frame(table(merged.18279.singlets$RNA_snn_res.0.7, merged.18279.singlets$functional.cluster, useNA = \"ifany\")) %&gt;%\n    as_tibble() %&gt;%\n    dplyr::rename(\"Cluster\" = Var1, \"CellState\" = Var2) %&gt;%\n    group_by(Cluster) %&gt;%\n    slice_max(Freq,n=1) %&gt;%\n    inner_join(enframe(table(merged.18279.singlets$RNA_snn_res.0.7),name=\"Cluster\",value=\"TotalCount\"),by=\"Cluster\") %&gt;%\n    as.data.frame()\n\n   Cluster     CellState Freq TotalCount\n1        0      CD4.Th17 1228       2023\n2        1      CD4.Th17 1738       1984\n3        2      CD4.Th17 1154       1845\n4        3       CD8.TEX  523       1165\n5        4      CD4.Th17  528       1093\n6        5       CD8.TEX  579        778\n7        6       CD8.TEX  184        470\n8        7 CD4.NaiveLike  123        373\n9        8      CD8.TPEX  169        355\n10       9       CD8.TEX   58        130\n11      10          &lt;NA&gt;   40        104\n\n\n\n\n3.4.3 Plot UMAP of all cells labeled by projected T cell state\n\nDimPlot(merged.18279.singlets, group.by = \"functional.cluster\", reduction=\"umap.harmony\")"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#plot-umap-labeled-by-cd3-cd4-cd8-expression-and-projectils-annotations",
    "href": "IFNg_scRNA_Part3.html#plot-umap-labeled-by-cd3-cd4-cd8-expression-and-projectils-annotations",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.5 Plot UMAP labeled by CD3, CD4, CD8 expression and ProjecTILs annotations",
    "text": "3.5 Plot UMAP labeled by CD3, CD4, CD8 expression and ProjecTILs annotations\n\nFeaturePlot(merged.18279.singlets,\n        features = c(\"CD3E\", \"CD3D\", \"CD8A\", \"CD4\"),\n        reduction = \"umap.harmony\", \n        order = TRUE) +\nDimPlot(merged.18279.singlets,\n        group.by = \"functional.cluster\",\n        reduction = \"umap.harmony\")"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#save-modified-object",
    "href": "IFNg_scRNA_Part3.html#save-modified-object",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.6 Save modified object",
    "text": "3.6 Save modified object\n\nsaveRDS(merged.18279.singlets, \"IFNg_scRNA_Part3.rds\")"
  },
  {
    "objectID": "IFNg_scRNA_Part3.html#get-session-info",
    "href": "IFNg_scRNA_Part3.html#get-session-info",
    "title": "3  IFNg: Classification of CD4 and CD8 T cell states",
    "section": "3.7 Get session info",
    "text": "3.7 Get session info\n\nsessionInfo()\n\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Rocky Linux 8.10 (Green Obsidian)\n\nMatrix products: default\nBLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.15.so;  LAPACK version 3.9.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: America/New_York\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] ProjecTILs_3.3.1            STACAS_2.2.2               \n [3] cellXY_0.99.0               scDblFinder_1.14.0         \n [5] harmony_1.2.0               alevinQC_1.16.1            \n [7] vctrs_0.6.5                 patchwork_1.3.0            \n [9] scater_1.28.0               scuttle_1.10.3             \n[11] speckle_1.0.0               Matrix_1.6-4               \n[13] fishpond_2.6.2              readxl_1.4.3               \n[15] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[17] Biobase_2.60.0              GenomicRanges_1.52.1       \n[19] GenomeInfoDb_1.36.4         IRanges_2.34.1             \n[21] S4Vectors_0.38.2            BiocGenerics_0.46.0        \n[23] MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[25] flexmix_2.3-19              lattice_0.22-5             \n[27] SeuratWrappers_0.3.19       miQC_1.8.0                 \n[29] lubridate_1.9.3             forcats_1.0.0              \n[31] stringr_1.5.1               dplyr_1.1.4                \n[33] purrr_1.0.2                 readr_2.1.5                \n[35] tidyr_1.3.1                 tibble_3.2.1               \n[37] ggplot2_3.4.4               tidyverse_2.0.0            \n[39] Seurat_5.1.0                SeuratObject_5.0.2         \n[41] sp_2.1-3                    sctransform_0.4.1          \n[43] glmGamPoi_1.12.2            presto_1.0.0               \n[45] Rcpp_1.0.12                 devtools_2.4.5             \n[47] usethis_2.2.2               data.table_1.15.0          \n\nloaded via a namespace (and not attached):\n  [1] fs_1.6.3                  spatstat.sparse_3.0-3    \n  [3] bitops_1.0-7              httr_1.4.7               \n  [5] RColorBrewer_1.1-3        profvis_0.3.8            \n  [7] tools_4.3.1               utf8_1.2.4               \n  [9] R6_2.5.1                  DT_0.31                  \n [11] lazyeval_0.2.2            uwot_0.1.16              \n [13] urlchecker_1.0.1          withr_3.0.0              \n [15] GGally_2.2.1              gridExtra_2.3            \n [17] progressr_0.14.0          cli_3.6.2                \n [19] spatstat.explore_3.2-6    fastDummies_1.7.3        \n [21] labeling_0.4.3            spatstat.data_3.0-4      \n [23] askpass_1.2.0             ggridges_0.5.6           \n [25] pbapply_1.7-2             Rsamtools_2.16.0         \n [27] R.utils_2.12.3            parallelly_1.37.0        \n [29] sessioninfo_1.2.2         limma_3.56.2             \n [31] RSQLite_2.3.5             BiocIO_1.10.0            \n [33] generics_0.1.3            gtools_3.9.5             \n [35] ica_1.0-3                 spatstat.random_3.2-2    \n [37] ggbeeswarm_0.7.2          fansi_1.0.6              \n [39] abind_1.4-5               R.methodsS3_1.8.2        \n [41] lifecycle_1.0.4           yaml_2.3.8               \n [43] edgeR_3.42.4              Rtsne_0.17               \n [45] blob_1.2.4                grid_4.3.1               \n [47] dqrng_0.3.2               promises_1.2.1           \n [49] crayon_1.5.2              shinydashboard_0.7.2     \n [51] miniUI_0.1.1.1            beachmat_2.16.0          \n [53] cowplot_1.1.3             KEGGREST_1.40.1          \n [55] scGate_1.6.0              metapod_1.8.0            \n [57] pillar_1.9.0              knitr_1.45               \n [59] rjson_0.2.21              xgboost_1.7.7.1          \n [61] future.apply_1.11.1       codetools_0.2-19         \n [63] leiden_0.4.3.1            glue_1.7.0               \n [65] remotes_2.4.2.1           png_0.1-8                \n [67] spam_2.10-0               org.Mm.eg.db_3.18.0      \n [69] cellranger_1.1.0          gtable_0.3.4             \n [71] cachem_1.0.8              xfun_0.42                \n [73] S4Arrays_1.2.0            mime_0.12                \n [75] pracma_2.4.4              survival_3.5-8           \n [77] pheatmap_1.0.12           statmod_1.5.0            \n [79] bluster_1.10.0            ellipsis_0.3.2           \n [81] fitdistrplus_1.1-11       ROCR_1.0-11              \n [83] nlme_3.1-164              bit64_4.0.5              \n [85] RcppAnnoy_0.0.22          irlba_2.3.5.1            \n [87] vipor_0.4.7               KernSmooth_2.23-22       \n [89] DBI_1.2.2                 colorspace_2.1-0         \n [91] nnet_7.3-19               UCell_2.6.2              \n [93] tidyselect_1.2.0          bit_4.0.5                \n [95] compiler_4.3.1            BiocNeighbors_1.18.0     \n [97] DelayedArray_0.26.7       plotly_4.10.4            \n [99] rtracklayer_1.60.1        scales_1.3.0             \n[101] lmtest_0.9-40             digest_0.6.34            \n[103] goftest_1.2-3             spatstat.utils_3.0-4     \n[105] rmarkdown_2.25            XVector_0.40.0           \n[107] htmltools_0.5.7           pkgconfig_2.0.3          \n[109] umap_0.2.10.0             sparseMatrixStats_1.12.2 \n[111] fastmap_1.1.1             rlang_1.1.3              \n[113] htmlwidgets_1.6.4         shiny_1.8.0              \n[115] DelayedMatrixStats_1.22.6 farver_2.1.1             \n[117] zoo_1.8-12                jsonlite_1.8.8           \n[119] BiocParallel_1.34.2       R.oo_1.26.0              \n[121] BiocSingular_1.16.0       RCurl_1.98-1.14          \n[123] magrittr_2.0.3            modeltools_0.2-23        \n[125] GenomeInfoDbData_1.2.10   dotCall64_1.1-1          \n[127] munsell_0.5.0             viridis_0.6.5            \n[129] reticulate_1.35.0         stringi_1.8.3            \n[131] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[133] org.Hs.eg.db_3.18.0       plyr_1.8.9               \n[135] pkgbuild_1.4.3            ggstats_0.5.1            \n[137] parallel_4.3.1            listenv_0.9.1            \n[139] ggrepel_0.9.5             deldir_2.0-2             \n[141] Biostrings_2.68.1         splines_4.3.1            \n[143] tensor_1.5                hms_1.1.3                \n[145] locfit_1.5-9.8            igraph_2.0.2             \n[147] spatstat.geom_3.2-8       RcppHNSW_0.6.0           \n[149] reshape2_1.4.4            ScaledMatrix_1.8.1       \n[151] pkgload_1.3.4             XML_3.99-0.16.1          \n[153] evaluate_0.23             scran_1.28.2             \n[155] BiocManager_1.30.22       tzdb_0.4.0               \n[157] httpuv_1.6.14             openssl_2.1.1            \n[159] RANN_2.6.1                polyclip_1.10-6          \n[161] future_1.33.1             scattermore_1.2          \n[163] rsvd_1.0.5                xtable_1.8-4             \n[165] restfulr_0.0.15           svMisc_1.2.3             \n[167] RSpectra_0.16-1           later_1.3.2              \n[169] viridisLite_0.4.2         AnnotationDbi_1.64.1     \n[171] GenomicAlignments_1.36.0  memoise_2.0.1            \n[173] beeswarm_0.4.0            tximport_1.28.0          \n[175] cluster_2.1.6             timechange_0.3.0         \n[177] globals_0.16.2"
  }
]