[
  {
    "objectID": "Skin_scRNA_Part10.html",
    "href": "Skin_scRNA_Part10.html",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "",
    "text": "10.1 Set up Seurat workspace\n# Load libraries\nlibrary(presto)\nlibrary(ggplot2)\nlibrary(Seurat)\nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(paletteer)\nlibrary(msigdbr)\nlibrary(ComplexHeatmap)\nlibrary(circlize)\nlibrary(SingleCellExperiment)\nlibrary(muscat)\nlibrary(limma)\nlibrary(scuttle)\nlibrary(lemon)\nlibrary(ggforce)\nlibrary(cowplot)\nlibrary(speckle)\nlibrary(knitr)",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#load-previous-saved-object",
    "href": "Skin_scRNA_Part10.html#load-previous-saved-object",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.2 Load previous saved object",
    "text": "10.2 Load previous saved object\n\nmerged.18279.skin.singlets &lt;- readRDS(\"Skin_scRNA_Part8.rds\")",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#set-up-cluster-groupings-by-cell-class",
    "href": "Skin_scRNA_Part10.html#set-up-cluster-groupings-by-cell-class",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.3 Set up cluster groupings by cell class",
    "text": "10.3 Set up cluster groupings by cell class\n\ncluster_annot &lt;- c(\n        \"0\" = \"MonoMac_1\",\n        \"1_0\" = \"CD4_T_Naive/CM\",\n        \"1_1\" = \"CD4_T_CTL\",\n        \"2_0\" = \"CD8_T_EM_1\",\n        \"2_1\" = \"CD8_T_Naive/CM_1\",\n        \"2_2\" = \"CD8_T_EM_2\",\n        \"3\" = \"MonoMac_2\",\n        \"4_0\" = \"CD8_T_Naive/CM_2\",\n        \"4_1\" = \"CD8_T_Naive/CM_3\",\n        \"5_0\" = \"NK/T_1\",\n        \"5_1\" = \"NK/T_2\",\n        \"5_2\" = \"NK_cells\",\n        \"6_0\" = \"T_unknown_1\",\n        \"6_1\" = \"CD8_T_EM_3\",\n        \"7\" = \"cDC2\",\n        \"8\" = \"Keratinocytes\",\n        \"9_0\" = \"Treg_1\",\n        \"9_1\" = \"Treg_2\",\n        \"10\" = \"Fibroblasts\",\n        \"11_0\" = \"T_unknown_2\",\n        \"11_1\" = \"T_unknown_3\",\n        \"12\" = \"MonoMac_3\",\n        \"13_0\" = \"Proliferating_T_cells_1\",\n        \"13_1\" = \"Proliferating_T_cells_2\",\n        \"14\" = \"pDC\",\n        \"15\" = \"DC_LAMP3\",\n        \"16\" = \"Mast\",\n        \"17\" = \"Endothelial\",\n        \"18\" = \"cDC1\",\n        \"19_0\" = \"NK/T_3\",\n        \"20\" = \"Pericytes/smooth_muscle\",\n        \"21\" = \"Basal_1\",\n        \"22\" = \"MonoMac_4\",\n        \"23\" = \"B_cells\",\n        \"24\" = \"Basal_2\",\n        \"25\" = \"Macrophages\",\n        \"26\" = \"Proliferating_cDC2\"\n)\nclustLabels &lt;- as.data.frame(cluster_annot)[merged.18279.skin.singlets$sub.cluster,]\nmerged.18279.skin.singlets &lt;- AddMetaData(merged.18279.skin.singlets, list(clustLabels), col.name = \"CellAnnotation\")",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#set-up-broader-cell-classes",
    "href": "Skin_scRNA_Part10.html#set-up-broader-cell-classes",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.4 Set up broader cell classes",
    "text": "10.4 Set up broader cell classes\n\ncluster_classes &lt;- enframe(cluster_annot,name = \"sub.cluster\",value = \"CellAnnotation\") %&gt;%\n  as_tibble() %&gt;%\n  mutate(CellClass = case_when(\n    sub.cluster %in% c(\"0\",\"3\",\"12\",\"22\",\"25\") ~ \"Monocyte/\\nMacrophage\",\n    sub.cluster %in% c(\"14\",\"18\",\"7\",\"26\",\"15\") ~ \"DC\",\n    sub.cluster %in% c(\"23\") ~ \"B\",\n    sub.cluster %in% c(\"5_2\",\"5_0\",\"5_1\",\"19_0\",\"2_1\",\"4_0\",\"4_1\",\"2_0\",\"2_2\",\"6_1\",\"1_0\",\"1_1\",\"9_0\",\"9_1\",\"13_0\",\"13_1\",\"6_0\",\"11_0\",\"11_1\") ~ \"NK/T\",\n    sub.cluster %in% c(\"16\") ~ \"Mast\",\n    sub.cluster %in% c(\"8\",\"10\",\"17\",\"20\",\"21\",\"24\") ~ \"Non-immune\"\n    )\n  ) %&gt;%\n  dplyr::select(-CellAnnotation) %&gt;%\n  column_to_rownames(var = \"sub.cluster\") %&gt;%\n  as.data.frame()\n\nclustClasses &lt;- cluster_classes[merged.18279.skin.singlets$sub.cluster,]\nmerged.18279.skin.singlets &lt;- AddMetaData(merged.18279.skin.singlets, list(clustClasses), col.name = \"CellClass\")",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-original-umap-labeled-by-sub-cluster",
    "href": "Skin_scRNA_Part10.html#plot-original-umap-labeled-by-sub-cluster",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.5 Plot original UMAP labeled by sub-cluster",
    "text": "10.5 Plot original UMAP labeled by sub-cluster\n\nmerged.18279.skin.singlets$CellAnnotation &lt;- factor(x = merged.18279.skin.singlets$CellAnnotation, \n                                                    levels = as.character(cluster_annot))\nDimPlot(merged.18279.skin.singlets, \n        label = FALSE, \n        reduction = \"umap.harmony\",\n        group.by = \"CellAnnotation\")\n\n\n\n\n\n\n\n\n\n10.5.1 Plot again split by Timepoint\n\nmerged.18279.skin.singlets$CellAnnotation &lt;- factor(x = merged.18279.skin.singlets$CellAnnotation, \n                                                    levels = as.character(cluster_annot))\nmerged.18279.skin.singlets$Timepoint &lt;- factor(x = merged.18279.skin.singlets$Timepoint, levels = c(\"Pre3rd\", \"Post3rd\"))\n\nDimPlot(merged.18279.skin.singlets, \n        label = FALSE, \n        reduction = \"umap.harmony\",\n        group.by = \"CellAnnotation\",\n        split.by = \"Timepoint\")",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-original-umap-labeled-by-broader-cell-class",
    "href": "Skin_scRNA_Part10.html#plot-original-umap-labeled-by-broader-cell-class",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.6 Plot original UMAP labeled by broader cell class",
    "text": "10.6 Plot original UMAP labeled by broader cell class\n\nDimPlot(merged.18279.skin.singlets, \n        label = FALSE, \n        reduction = \"umap.harmony\",\n        group.by = \"CellClass\")\n\n\n\n\n\n\n\n\n\n10.6.1 Plot again except split by Timepoint\n\nDimPlot(merged.18279.skin.singlets, \n        label = FALSE, \n        reduction = \"umap.harmony\",\n        split.by = \"Timepoint\",\n        group.by = \"CellClass\") +\n  theme_classic() +\n  theme(panel.border = element_rect(colour = \"black\",fill = NA)\n        )",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#now-plot-all-cluster-annotations-using-only-ggplot-functions-useful-later",
    "href": "Skin_scRNA_Part10.html#now-plot-all-cluster-annotations-using-only-ggplot-functions-useful-later",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.7 Now plot all cluster annotations using only ggplot functions, useful later",
    "text": "10.7 Now plot all cluster annotations using only ggplot functions, useful later\n\numap &lt;- rownames_to_column(as.data.frame(Embeddings(merged.18279.skin.singlets,reduction = \"umap.harmony\")),var=\"Barcode\") %&gt;%\n  as_tibble() %&gt;%\n  left_join(enframe(merged.18279.skin.singlets$sub.cluster,name = \"Barcode\",value=\"sub.cluster\"),by=\"Barcode\") %&gt;%\n  left_join(enframe(merged.18279.skin.singlets$CellAnnotation,name = \"Barcode\",value=\"CellAnnotation\"),by=\"Barcode\")\n\numap %&gt;%\n  ggplot(aes(x = umapharmony_1, y = umapharmony_2, color = CellAnnotation)) +\n  geom_point(size=0.25) +\n  theme_bw()",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-umap-split-by-ipilimumab-concentration-cohort-and-timepoint",
    "href": "Skin_scRNA_Part10.html#plot-umap-split-by-ipilimumab-concentration-cohort-and-timepoint",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.8 Plot UMAP split by Ipilimumab concentration cohort and Timepoint",
    "text": "10.8 Plot UMAP split by Ipilimumab concentration cohort and Timepoint\n\nrownames_to_column(as.data.frame(Embeddings(merged.18279.skin.singlets,reduction = \"umap.harmony\")),var=\"Barcode\") %&gt;%\n    as_tibble() %&gt;%\n    left_join(enframe(merged.18279.skin.singlets$sub.cluster,name = \"Barcode\",value=\"sub.cluster\"),by=\"Barcode\") %&gt;%\n    left_join(enframe(merged.18279.skin.singlets$CellClass,name = \"Barcode\",value=\"CellClass\"),by=\"Barcode\") %&gt;%\n    mutate(Timepoint = str_split_i(Barcode,pattern = \"_\",i = 3)) %&gt;%\n    mutate(IpiCohort = str_split_i(Barcode,pattern = \"_\", i = 4)) %&gt;%\n    ggplot(aes(x = umapharmony_1, y = umapharmony_2, color = CellClass)) +\n    geom_point(size = 0.25) +\n    facet_grid(IpiCohort ~ fct_relevel(Timepoint,c(\"Pre3rd\",\"Post3rd\"))) +\n    theme_bw() +\n    geom_text(aes(x, y, label = lab),\n              data = data.frame(x = 13, \n                                y = 14, \n                                lab = c(paste0(\"n = \", table(merged.18279.skin.singlets$IpiCohort,merged.18279.skin.singlets$Timepoint)[1,1]),\n                                        paste0(\"n = \", table(merged.18279.skin.singlets$IpiCohort,merged.18279.skin.singlets$Timepoint)[1,2]), \n                                        paste0(\"n = \", table(merged.18279.skin.singlets$IpiCohort,merged.18279.skin.singlets$Timepoint)[2,1]),\n                                        paste0(\"n = \", table(merged.18279.skin.singlets$IpiCohort,merged.18279.skin.singlets$Timepoint)[2,2])\n                                        ),\n                                Timepoint = c(\"Pre3rd\",\"Post3rd\",\"Pre3rd\",\"Post3rd\"),\n                                IpiCohort = c(\"2.5mgIpi\",\"2.5mgIpi\",\"5mgIpi\",\"5mgIpi\")\n                                ), \n                inherit.aes = FALSE\n            )",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-large-heatmap-demonstrating-marker-gene-selectivity-and-cluster-identity",
    "href": "Skin_scRNA_Part10.html#plot-large-heatmap-demonstrating-marker-gene-selectivity-and-cluster-identity",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.9 Plot large heatmap demonstrating marker gene selectivity and cluster identity",
    "text": "10.9 Plot large heatmap demonstrating marker gene selectivity and cluster identity\n\nmerged.18279.skin.singlets[['RNA']] &lt;- JoinLayers(merged.18279.skin.singlets[['RNA']])\nmerged.sce &lt;- as.SingleCellExperiment(merged.18279.skin.singlets, assay=\"RNA\")\n\n(mergedCondition.sce &lt;- prepSCE(merged.sce,\n        kid = \"sub.cluster\",\n        gid = \"Timepoint\",\n        sid = \"Sample\",\n        drop = TRUE))\n\nclass: SingleCellExperiment \ndim: 61217 33397 \nmetadata(1): experiment_info\nassays(2): counts logcounts\nrownames(61217): 5-8S-rRNA 5S-rRNA ... ZZEF1 ZZZ3\nrowData names(0):\ncolnames(33397): P101_Skin_Pre3rd_2.5mgIpi_RNA_GCACATAAGTGCCATT\n  P101_Skin_Pre3rd_2.5mgIpi_RNA_GGAACTTGTCGCGGTT ...\n  P111_Skin_Post3rd_5mgIpi_RNA_ACGATGTTCCTAGGGC\n  P111_Skin_Post3rd_5mgIpi_RNA_GAACATCAGCCACGTC\ncolData names(3): cluster_id sample_id group_id\nreducedDimNames(4): PCA UMAP.UNINTEGRATED INTEGRATED.HARMONY\n  UMAP.HARMONY\nmainExpName: RNA\naltExpNames(0):\n\nall_genes_to_plot &lt;- c(\"PTPRC\",\"TCF4\",\"TNFSF10\",\"S100A8\",\"S100A9\",\"RNASE1\",\"MARCO\",\"SIGLEC1\",\"CD14\",\"ITGAM\",\"ITGAX\",\"FCN1\",\"APOBEC3A\",\"SERPINA1\",\"FOLR2\",\"LILRB5\",\"CD163\",\"APOE\",\"FABP5\",\"LIPA\",\"APOC1\",\"TREM2\",\"CD68\",\"CSF1R\",\"FCGR3A\",\"C1QA\",\"C1QB\",\"C1QC\",\"ICAM1\",\"LGALS9\",\"CD40\",\"CD80\",\"CD86\",\"HLA-DRA\",\"HLA-DRB1\",\"HLA-DQA1\",\"HLA-DQA2\",\"HLA-DQB1\",\"HLA-DQB2\",\"IL3RA\",\"IRF4\",\"IRF8\",\"CLEC4C\",\"CLEC9A\",\"CLEC10A\",\"CD1C\",\"CD1E\",\"FCER1A\",\"CD207\",\"MARCKSL1\",\"FSCN1\",\"LAMP3\",\"LY75\",\"FLT3\",\"CD274\",\"BANK1\",\"CD79A\",\"MS4A1\",\"CD19\",\"NCR1\",\"NCAM1\",\"CD3E\",\"CD3G\", \"CD4\",\"CD8A\",\"TRAC\",\"TRBC1\",\"TRBC2\",\"TRDC\",\"IL7R\",\"CCR7\",\"SELL\",\"CD27\",\"TCF7\",\"CXCR6\",\"CCR6\",\"NKG7\",\"GNLY\",\"GZMA\",\"GZMB\",\"PRF1\",\"PDCD1\",\"LAG3\",\"TIGIT\",\"CTLA4\",\"TOX\",\"BATF\",\"TNFRSF4\",\"ICOS\",\"IL2RA\",\"FOXP3\",\"TNFRSF18\",\"KIT\",\"MKI67\",\"TOP2A\",\"HPGD\",\"CPA3\",\"SFN\",\"CXCL14\",\"CAV1\",\"DCN\",\"LUM\",\"PECAM1\",\"VWF\",\"TAGLN\",\"CALD1\",\"KRT5\",\"DMKN\",\"TACSTD2\")\n\ncluster_order &lt;- c(\"0\",\"3\",\"12\",\"22\",\"25\",\"14\",\"18\",\"7\",\"26\",\"15\",\"23\",\"5_2\",\"5_0\",\"5_1\",\"19_0\",\"2_1\",\"4_0\",\"4_1\",\"2_0\",\"2_2\",\"6_1\",\"1_0\",\"1_1\",\"9_0\",\"9_1\",\"13_0\",\"13_1\",\"6_0\",\"11_0\",\"11_1\",\"16\",\"8\",\"10\",\"17\",\"20\",\"21\",\"24\")\nslice_order &lt;- factor(cluster_classes[cluster_order,], levels = unique(cluster_classes[cluster_order,]))\n\ngene_categories &lt;- enframe(all_genes_to_plot,name=NULL,value=\"Gene\") %&gt;%\n  as_tibble() %&gt;%\n  mutate(GeneClass = case_when(\n    Gene %in% c(\"PTPRC\") ~ \"Immune\",\n    Gene %in% c(\"TCF4\",\"TNFSF10\",\"S100A8\",\"S100A9\",\"RNASE1\",\"MARCO\",\"SIGLEC1\",\"CD14\",\"ITGAM\",\"ITGAX\",\"FCN1\",\"APOBEC3A\",\"SERPINA1\",\"FOLR2\",\"LILRB5\",\"CD163\",\"APOE\",\"FABP5\",\"LIPA\",\"APOC1\",\"TREM2\",\"CD68\",\"CSF1R\",\"FCGR3A\",\"C1QA\",\"C1QB\",\"C1QC\",\"ICAM1\",\"LGALS9\") ~ \"Monocyte/\\nMacrophage\",\n    Gene %in% c(\"CD40\",\"CD80\",\"CD86\",\"HLA-DRA\",\"HLA-DRB1\",\"HLA-DQA1\",\"HLA-DQA2\",\"HLA-DQB1\",\"HLA-DQB2\",\"IL3RA\",\"IRF4\",\"IRF8\",\"CLEC4C\",\"CLEC9A\",\"CLEC10A\",\"CD1C\",\"CD1E\",\"FCER1A\",\"CD207\",\"MARCKSL1\",\"FSCN1\",\"LAMP3\",\"LY75\",\"FLT3\",\"CD274\") ~ \"Dendritic\\ncell\",\n    Gene %in% c(\"BANK1\",\"CD79A\",\"MS4A1\",\"CD19\") ~ \"B cell\",\n    Gene %in% c(\"NCR1\",\"NCAM1\") ~ \"NK cell\",\n    Gene %in% c(\"CD3E\",\"CD3G\",\"CD4\",\"CD8A\",\"TRAC\",\"TRBC1\",\"TRBC2\",\"TRDC\",\"IL7R\",\"CCR7\",\"SELL\",\"CD27\",\"TCF7\") ~ \"T cell\",\n    Gene %in% c(\"CXCR6\",\"CCR6\",\"NKG7\",\"GNLY\",\"GZMA\",\"GZMB\",\"PRF1\",\"PDCD1\",\"LAG3\",\"TIGIT\",\"CTLA4\",\"TOX\",\"BATF\",\"TNFRSF4\",\"ICOS\",\"IL2RA\",\"FOXP3\",\"TNFRSF18\",\"KIT\") ~ \"T cell\\nsubsets/\\nNK cells\",\n    Gene %in% c(\"MKI67\",\"TOP2A\") ~ \"Proliferation\",\n    Gene %in% c(\"SFN\",\"CXCL14\",\"CAV1\") ~ \"Keratinocyte\",\n    Gene %in% c(\"DCN\",\"LUM\") ~ \"Fibroblast\",\n    Gene %in% c(\"HPGD\",\"CPA3\") ~ \"Mast cell\",\n    Gene %in% c(\"PECAM1\",\"VWF\") ~ \"Endothelial\",\n    Gene %in% c(\"TAGLN\",\"CALD1\") ~ \"Pericyte/\\nsmooth muscle\",\n    Gene %in% c(\"KRT5\",\"DMKN\",\"TACSTD2\") ~ \"Basal\"\n    )\n  )\n  \ngene_slice_order &lt;- factor(gene_categories$GeneClass, levels = unique(gene_categories$GeneClass))\n  \npb_all &lt;- aggregateData(mergedCondition.sce,\n    assay = \"counts\",\n    fun = \"mean\",\n    by = \"cluster_id\")\n\nall_genes_to_plot &lt;- all_genes_to_plot[all_genes_to_plot %in% rownames(assay(pb_all))]\nmat &lt;- assay(pb_all)[all_genes_to_plot,cluster_order]\ncolnames(mat) &lt;- cluster_annot[cluster_order]\nComplexHeatmap::Heatmap(mat,\n                        col = circlize::colorRamp2(c(0,3),hcl_palette = \"viridis\"),\n                        cluster_rows = FALSE,\n                        cluster_columns = FALSE,\n                        column_split = slice_order,\n                        row_split = gene_slice_order,\n                        row_title_rot = 0,\n                        cluster_column_slices = FALSE,\n                        border = TRUE,\n                        row_names_gp = gpar(fontsize=6,fontface=\"italic\"),\n                        column_names_gp = gpar(fontsize=8),\n                        column_title_gp = gpar(fontsize=8,fontface=\"bold\"),\n                        row_title_gp = gpar(fontsize=8,fontface=\"bold\"),\n                        name = \"Mean expression\",\n                        heatmap_legend_param = list(title_position = \"leftcenter-rot\",border = TRUE)\n                  )",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-heatmap-of-functional-genes",
    "href": "Skin_scRNA_Part10.html#plot-heatmap-of-functional-genes",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "10.10 Plot heatmap of functional genes",
    "text": "10.10 Plot heatmap of functional genes\n\nfunctional_genes_to_plot &lt;- c(\"IDO1\",\"CCL2\",\"CXCL10\",\"CXCL2\",\"CXCL3\",\"IL10\",\"IL18\",\"IL1B\",\"CXCL8\",\"CXCL16\",\"LYZ\",\"IL15\",\"CCL19\",\"CXCL19\",\"TNF\",\"CCL3\",\"CCL4\",\"CCL5\",\"XCL1\",\"XCL2\",\"IFNG\",\"CSF2\")\n\nfunctional_genes_to_plot &lt;- functional_genes_to_plot[functional_genes_to_plot %in% rownames(assay(pb_all))]\nfx_mat &lt;- assay(pb_all)[functional_genes_to_plot,cluster_order]\ncolnames(fx_mat) &lt;- cluster_annot[cluster_order]\nComplexHeatmap::Heatmap(fx_mat,\n                        col = circlize::colorRamp2(c(0,3),hcl_palette = \"viridis\"),\n                        cluster_rows = FALSE,\n                        cluster_columns = FALSE,\n                        column_split = slice_order,\n                        cluster_column_slices = FALSE,\n                        border = TRUE,\n                        row_names_gp = gpar(fontsize=6,fontface=\"italic\"),\n                        column_names_gp = gpar(fontsize=8),\n                        column_title_gp = gpar(fontsize=8,fontface=\"bold\"),\n                        name = \"Mean expression\",\n                        heatmap_legend_param = list(title_position = \"leftcenter-rot\",border = TRUE)\n                  )",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-boxplots-of-cell-proportion-differences-pre-vs-post-connecting-patients-with-a-line",
    "href": "Skin_scRNA_Part10.html#plot-boxplots-of-cell-proportion-differences-pre-vs-post-connecting-patients-with-a-line",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "11.1 Plot boxplots of cell proportion differences, Pre vs Post, connecting patients with a line",
    "text": "11.1 Plot boxplots of cell proportion differences, Pre vs Post, connecting patients with a line\n\ntotalsPerSample &lt;- enframe(table(merged.18279.skin.singlets$Sample),name=\"Sample\",value=\"TotalCells\") %&gt;%\n    as_tibble() %&gt;%\n    mutate(TotalCells = as.numeric(TotalCells)) %&gt;%\n    mutate(Sample = str_replace_all(Sample,\"_.{1,3}mgIpi_RNA\",\"\"))\n\nCellAnnotation.labels &lt;- enframe(cluster_annot,value=\"CellAnnotation\") %&gt;%\n  as_tibble() %&gt;%\n  left_join(sigProps,by = c(\"CellAnnotation\" = \"Annot\")) %&gt;%\n    mutate(CellAnnotation.labels = case_when(\n      adj.P.Val &lt; 0.05 ~ paste0(CellAnnotation,\"**\\nadj.p = \",round(adj.P.Val,4)),\n      (adj.P.Val &gt;= 0.05) & (adj.P.Val &lt; 0.1) ~ paste0(CellAnnotation,\"*\\nadj.p = \",round(adj.P.Val,4)),\n      is.na(adj.P.Val) ~ CellAnnotation\n      )\n    ) %&gt;%\n  dplyr::select(CellAnnotation,CellAnnotation.labels) %&gt;%\n  deframe()\n\nrownames_to_column(as.data.frame(merged.18279.skin.singlets@meta.data),var=\"Barcode\") %&gt;%\n    as_tibble() %&gt;%\n    dplyr::select(Barcode,sub.cluster,Sample,CellAnnotation) %&gt;%\n    mutate(Sample = str_replace_all(Sample,\"_.{1,3}mgIpi_RNA\",\"\")) %&gt;%\n    group_by(CellAnnotation,Sample) %&gt;%\n    summarize(n = dplyr::n()) %&gt;%\n    ungroup() %&gt;%\n    complete(Sample,CellAnnotation) %&gt;%             # Makes sure 0s get represented rather than omitted\n    mutate(n = replace_na(n,0)) %&gt;%\n    mutate(Patient = str_split_i(Sample,pattern = \"_\",i = 1)) %&gt;%\n    mutate(Site = str_split_i(Sample,pattern = \"_\",i = 2)) %&gt;%\n    mutate(Timepoint = str_split_i(Sample,pattern = \"_\",i = 3)) %&gt;%\n    mutate(Timepoint = str_replace_all(Timepoint,\"3rd\",\"\")) %&gt;%\n    right_join(totalsPerSample,.,by=\"Sample\") %&gt;%\n      group_by(Sample) %&gt;%\n      mutate(Proportion = n / TotalCells) %&gt;%\n    left_join(sigProps,by = c(\"CellAnnotation\" = \"Annot\")) %&gt;%\n    mutate(CellAnnotation = factor(CellAnnotation, levels = cluster_annot[cluster_order])) %&gt;%\n    ungroup() %&gt;%\n    ggplot(aes(x = fct_relevel(Timepoint,c(\"Pre\",\"Post\")),\n               y = Proportion,\n               fill = fct_relevel(Timepoint,c(\"Pre\",\"Post\"))\n              )\n           ) +\n      geom_boxplot(outlier.shape=NA, width = 0.5) +\n    facet_wrap(~CellAnnotation,scales=\"free_y\") +\n      lemon::geom_pointpath(aes(group=Patient), \n                            position = position_jitterdodge(jitter.width = 0.1,\n                                                            dodge.width = 0.4,\n                                                            seed=123)\n                            ) +\n      facet_wrap(~CellAnnotation,scales=\"free_y\",ncol=6,labeller = as_labeller(CellAnnotation.labels)) +\n    theme_bw() +\n    theme(axis.text.y = element_text(size=10),\n        strip.text = element_text(size=8,face=\"bold\"),\n        axis.title = element_text(size=10,face=\"bold\"),\n        legend.text = element_text(size=10),\n        legend.title = element_text(size=10,face=\"bold\"),\n        legend.key.size = unit(2,\"line\"),\n        panel.grid = element_blank(), \n        panel.grid.minor = element_blank(),\n        panel.border = element_rect(fill = NA, color = \"black\")\n        ) +\n      xlab(\"Timepoint\") +\n      ylab(\"Skin composition fraction\") +\n    labs(fill = \"Timepoint\") +\n    scale_fill_manual(values=c(\"lightgreen\",\"darkgreen\"))\n\n`summarise()` has grouped output by 'CellAnnotation'. You can override using\nthe `.groups` argument.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#plot-the-same-except-now-facet-both-by-cluster-and-ipilimumab-concentration-cohort",
    "href": "Skin_scRNA_Part10.html#plot-the-same-except-now-facet-both-by-cluster-and-ipilimumab-concentration-cohort",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "11.2 Plot the same except now facet both by Cluster and Ipilimumab concentration cohort",
    "text": "11.2 Plot the same except now facet both by Cluster and Ipilimumab concentration cohort\n\nrownames_to_column(as.data.frame(merged.18279.skin.singlets@meta.data),var=\"Barcode\") %&gt;%\n    as_tibble() %&gt;%\n    dplyr::select(Barcode,sub.cluster,Sample,CellAnnotation) %&gt;%\n    group_by(CellAnnotation,Sample) %&gt;%\n    summarize(n = dplyr::n()) %&gt;%\n    ungroup() %&gt;%\n    complete(Sample,CellAnnotation) %&gt;%             # Makes sure 0s get represented rather than omitted\n    mutate(n = replace_na(n,0)) %&gt;%\n    mutate(Patient = str_split_i(Sample,pattern = \"_\",i = 1)) %&gt;%\n    mutate(Site = str_split_i(Sample,pattern = \"_\",i = 2)) %&gt;%\n    mutate(Timepoint = str_split_i(Sample,pattern = \"_\",i = 3)) %&gt;%\n    mutate(Timepoint = str_replace_all(Timepoint,\"3rd\",\"\")) %&gt;%\n    mutate(IpiCohort = str_split_i(Sample,pattern = \"_\",i = 4)) %&gt;%\n    mutate(Sample = str_replace_all(Sample,\"_.{1,3}mgIpi_RNA\",\"\"))  %&gt;%\n    right_join(totalsPerSample,.,by=\"Sample\") %&gt;%\n      group_by(Sample) %&gt;%\n      mutate(Proportion = n / TotalCells) %&gt;%\n    left_join(sigProps,by = c(\"CellAnnotation\" = \"Annot\")) %&gt;%\n    mutate(CellAnnotation = factor(CellAnnotation, levels = cluster_annot[cluster_order])) %&gt;%\n    ungroup() %&gt;%\n    ggplot(aes(x = fct_relevel(Timepoint,c(\"Pre\",\"Post\")),\n               y = Proportion,\n               fill = fct_relevel(Timepoint,c(\"Pre\",\"Post\"))\n              )\n           ) +\n      geom_boxplot(outlier.shape=NA, width = 0.5) +\n    geom_point(aes(color = Patient), position = position_jitterdodge(jitter.width=0.1,dodge.width = 0.4)) +\n    facet_grid(CellAnnotation~IpiCohort,scales=\"free\") +\n    theme_bw() +\n    theme(axis.text.y = element_text(size=10),\n        strip.text = element_text(size=8,face=\"bold\"),\n        axis.title = element_text(size=10,face=\"bold\"),\n        legend.text = element_text(size=10),\n        legend.title = element_text(size=10,face=\"bold\"),\n        legend.key.size = unit(2,\"line\"),\n        panel.grid = element_blank(), \n        panel.grid.minor = element_blank(),\n        panel.border = element_rect(fill = NA, color = \"black\"),\n        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)\n        ) +\n      xlab(\"Timepoint\") +\n      ylab(\"Skin composition fraction\") +\n    labs(fill = \"Cohort\", color = \"Patient\") +\n    scale_color_manual(values = c(\"#59A14FFF\",  \n                                  \"#B07AA1FF\", \n                                  \"#76B7B2FF\", \n                                  \"#FBB258FF\", \n                                  \"#DC050CFF\", \n                                  \"#F6AAC9FF\", \n                                  \"#5CA2E5FF\", \n                                  \"#615EBFFF\", \n                                  \"#826250FF\")) +\n    scale_fill_manual(values=c(\"lightgreen\",\"darkgreen\"))\n\n`summarise()` has grouped output by 'CellAnnotation'. You can override using\nthe `.groups` argument.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#prepare-umap-with-clusters-of-interest-circled",
    "href": "Skin_scRNA_Part10.html#prepare-umap-with-clusters-of-interest-circled",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "11.3 Prepare UMAP with clusters of interest circled",
    "text": "11.3 Prepare UMAP with clusters of interest circled\n\numap_circled &lt;- umap %&gt;%\n    ggplot(aes(x = umapharmony_1, y = umapharmony_2, color = CellAnnotation)) +\n    geom_point(size = 0.25) +\n    theme_classic() +\n    geom_shape(data = umap %&gt;% dplyr::filter(sub.cluster==\"0\"), \n               stat = \"ellipse\", \n               expand = unit(0.25, 'cm'), \n               fill = NA, \n               color = \"black\", \n               linetype = 2) +\n    geom_shape(data = umap %&gt;% dplyr::filter(sub.cluster==\"12\"), \n               stat = \"ellipse\", \n               expand = unit(0.25, 'cm'), \n               fill = NA, \n               color = \"black\", \n               linetype = 2) +\n    geom_shape(data = umap %&gt;% dplyr::filter(sub.cluster==\"15\"), \n               stat = \"ellipse\", \n               expand = unit(0.25, 'cm'), \n               fill = NA, \n               color = \"black\", \n               linetype = 2) +\n    geom_shape(data = umap %&gt;% dplyr::filter(sub.cluster==\"5_2\"),\n               stat = \"ellipse\",\n               expand = unit(0.25, 'cm'),\n               fill = NA,\n               color = \"black\",\n               linetype = 2) +\n  guides(color = \"none\")\n\numap_circled",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#for-each-cluster-of-interest-plot-differentially-expressed-genes-as-a-heatmap-and-add-annotation-layer-illustrating-changing-cell-proportions",
    "href": "Skin_scRNA_Part10.html#for-each-cluster-of-interest-plot-differentially-expressed-genes-as-a-heatmap-and-add-annotation-layer-illustrating-changing-cell-proportions",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "11.4 For each cluster of interest, plot differentially expressed genes as a heatmap and add annotation layer illustrating changing cell proportions",
    "text": "11.4 For each cluster of interest, plot differentially expressed genes as a heatmap and add annotation layer illustrating changing cell proportions\n\n11.4.1 Create function for centering expression values around mean of Pre3rd samples\n\ncontrolCenter &lt;- function(data_matrix = NULL, pattern_for_controls = NULL, pattern_for_others = NULL) {\n  stopifnot(is.matrix(data_matrix))\n\n    ctrl_means &lt;- apply(data_matrix, 1, function(x) {mean(x[grep(pattern_for_controls,colnames(data_matrix))])})\n    data_matrix_centered &lt;- as.data.frame(matrix(data=NA,nrow=length(rownames(data_matrix)),ncol=length(colnames(data_matrix))))\n    rownames(data_matrix_centered) &lt;- rownames(data_matrix)\n    colnames(data_matrix_centered) &lt;- colnames(data_matrix)[c(grep(pattern_for_controls,colnames(data_matrix)),grep(pattern_for_others,colnames(data_matrix)))]\n\n    for (i in 1:length(ctrl_means)) {\n      data_matrix_centered[i,] &lt;- as.numeric(data_matrix[i,c(grep(pattern_for_controls,colnames(data_matrix)),grep(pattern_for_others,colnames(data_matrix)))]) - as.numeric(ctrl_means[i])\n    }\n  return &lt;- data_matrix_centered\n  \n}\n\n\n\n11.4.2 Create pseudobulks for plotting\nUse mean (rather than sum) to control for varying number of cells\n\n(mergedCondition.sce &lt;- prepSCE(merged.sce,\n        kid = \"sub.cluster\",\n        gid = \"Timepoint\",\n        sid = \"Sample\",\n        drop = TRUE))\n\nclass: SingleCellExperiment \ndim: 61217 33397 \nmetadata(1): experiment_info\nassays(2): counts logcounts\nrownames(61217): 5-8S-rRNA 5S-rRNA ... ZZEF1 ZZZ3\nrowData names(0):\ncolnames(33397): P101_Skin_Pre3rd_2.5mgIpi_RNA_GCACATAAGTGCCATT\n  P101_Skin_Pre3rd_2.5mgIpi_RNA_GGAACTTGTCGCGGTT ...\n  P111_Skin_Post3rd_5mgIpi_RNA_ACGATGTTCCTAGGGC\n  P111_Skin_Post3rd_5mgIpi_RNA_GAACATCAGCCACGTC\ncolData names(3): cluster_id sample_id group_id\nreducedDimNames(4): PCA UMAP.UNINTEGRATED INTEGRATED.HARMONY\n  UMAP.HARMONY\nmainExpName: RNA\naltExpNames(0):\n\npb &lt;- aggregateData(mergedCondition.sce,\n    assay = \"counts\",\n    fun = \"mean\",\n    by = c(\"cluster_id\", \"sample_id\"))\n\n\n\n11.4.3 Create cell proportion table per Sample and per sub-cluster\n\nprops &lt;- rownames_to_column(as.data.frame(merged.18279.skin.singlets@meta.data),var=\"Barcode\") %&gt;%\n    as_tibble() %&gt;%\n    dplyr::select(Barcode,CellAnnotation,Sample) %&gt;%\n    mutate(Sample = str_replace_all(Sample,\"_.{1,3}mgIpi_RNA\",\"\")) %&gt;%\n    group_by(CellAnnotation,Sample) %&gt;%\n    summarize(n = dplyr::n()) %&gt;%\n    ungroup() %&gt;%\n    complete(Sample,CellAnnotation) %&gt;%             # Makes sure 0s get represented rather than omitted\n    mutate(n = replace_na(n,0)) %&gt;%\n    mutate(Patient = str_split_i(Sample,pattern = \"_\",i = 1)) %&gt;%\n    mutate(Site = str_split_i(Sample,pattern = \"_\",i = 2)) %&gt;%\n    mutate(Timepoint = str_split_i(Sample,pattern = \"_\",i = 3)) %&gt;%\n    mutate(Timepoint = str_replace_all(Timepoint,\"3rd\",\"\")) %&gt;%\n    right_join(totalsPerSample,.,by=\"Sample\") %&gt;%\n    mutate(Sample = str_replace_all(Sample,\"_Skin\",\"\")) %&gt;%\n    mutate(Sample = str_replace_all(Sample,\"3rd\",\"\")) %&gt;%\n      group_by(Sample) %&gt;%\n      mutate(Proportion = n / TotalCells)\n\n`summarise()` has grouped output by 'CellAnnotation'. You can override using\nthe `.groups` argument.\n\nprops\n\n# A tibble: 629 × 8\n# Groups:   Sample [17]\n   Sample    TotalCells CellAnnotation      n Patient Site  Timepoint Proportion\n   &lt;chr&gt;          &lt;dbl&gt; &lt;fct&gt;           &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;\n 1 P101_Post       1718 MonoMac_1         410 P101    Skin  Post        0.239   \n 2 P101_Post       1718 CD4_T_Naive/CM     74 P101    Skin  Post        0.0431  \n 3 P101_Post       1718 CD4_T_CTL          15 P101    Skin  Post        0.00873 \n 4 P101_Post       1718 CD8_T_EM_1         70 P101    Skin  Post        0.0407  \n 5 P101_Post       1718 CD8_T_Naive/CM…    25 P101    Skin  Post        0.0146  \n 6 P101_Post       1718 CD8_T_EM_2         18 P101    Skin  Post        0.0105  \n 7 P101_Post       1718 MonoMac_2         264 P101    Skin  Post        0.154   \n 8 P101_Post       1718 CD8_T_Naive/CM…    80 P101    Skin  Post        0.0466  \n 9 P101_Post       1718 CD8_T_Naive/CM…     1 P101    Skin  Post        0.000582\n10 P101_Post       1718 NK/T_1             18 P101    Skin  Post        0.0105  \n# ℹ 619 more rows\n\n\n\n\n11.4.4 Cluster 0\n\n# Subset to genes of interest and reorder columns\ncluster &lt;- \"0\"\ngoi &lt;- c(\"IL6\",\"TNF\",\"CXCL10\",\"CXCL11\",\"CCL2\",\"CCL3\",\"CCL4\",\"CCL5\",\"CCL8\",\"IL15\",\"SELL\")\npb_cluster &lt;- assays(pb)[[cluster]][goi,]\npb_cluster_cnames &lt;- str_replace_all(str_replace_all(colnames(pb_cluster),\"3rd_.{1,3}mgIpi_RNA\",\"\"),\"_Skin\",\"\")\ncolnames(pb_cluster) &lt;- pb_cluster_cnames\npb_cluster_cnames_sorted &lt;- pb_cluster_cnames[c(which(grepl(\"Pre\",pb_cluster_cnames)),which(grepl(\"Post\",pb_cluster_cnames)))]\n\n# Subset proportions table\ncluster_props &lt;- props %&gt;%\n  dplyr::filter(CellAnnotation == cluster_annot[cluster]) %&gt;%\n  dplyr::select(Sample,Proportion) %&gt;%\n  ungroup() %&gt;%\n  mutate(Sample = fct_relevel(as.factor(Sample),pb_cluster_cnames_sorted)) %&gt;%\n  dplyr::arrange(Sample) %&gt;%\n  as.data.frame()\n\n# Center expression around mean of Pre samples\npb_centered &lt;- controlCenter(pb_cluster[,pb_cluster_cnames_sorted], pattern_for_controls = \"Pre\", pattern_for_others = \"Post\")\n\n# Plot heatmap\ntimepoints &lt;- as.factor(str_split_i(pb_cluster_cnames_sorted,\"_\",2))\nha1 &lt;- HeatmapAnnotation(Timepoint = timepoints,\n                         show_legend = FALSE,\n                         col = list(Timepoint = setNames(c(\"lightgreen\", \"darkgreen\"), c(\"Pre\", \"Post\"))), \n                         border = TRUE)\nha2 &lt;- HeatmapAnnotation(Proportion = anno_barplot(round(cluster_props$Proportion,3), \n                                                   gp = gpar(fill = c(\n                                                      rep(\"lightgreen\",length(which(str_detect(cluster_props$Sample,\"Pre\")))), \n                                                      rep(\"darkgreen\",length(which(str_detect(cluster_props$Sample,\"Post\"))))\n                                                      )\n                                                     ), \n                                                   add_numbers = TRUE,\n                                                   numbers_rot = 0\n                                                   )\n                         )\n\np0 &lt;- ComplexHeatmap::Heatmap(pb_centered,\n                        cluster_rows = FALSE,\n                        cluster_columns = FALSE,\n                        column_split = factor(timepoints,levels = c(\"Pre\",\"Post\")),\n                        column_labels = str_replace_all(colnames(pb_centered),\"_Pre|_Post\",\"\"),\n                        row_names_gp = gpar(fontface = \"italic\",fontsize = 8),\n                        column_names_gp = gpar(fontsize = 8),\n                        col = colorRamp2(c(0,5),hcl_palette = \"viridis\"),\n                        border = TRUE,\n                        column_title = paste0(\"Cluster \", cluster, \": \",cluster_annot[cluster]),\n                        column_title_gp = gpar(fontface = \"bold\"),\n                        name = \"Expression relative to Pre\",\n                        top_annotation = c(ha1,ha2),\n                        show_heatmap_legend = FALSE\n) %&gt;% \n  draw() %&gt;% \n  grid.grabExpr()\n\nWarning: The input is a data frame-like object, convert it to a matrix.\n\n\n\n\n11.4.5 Cluster 12\n\n# Subset to genes of interest and reorder columns\ncluster &lt;- \"12\"\ngoi &lt;- c(\"CXCL10\",\"CXCL9\",\"CXCL11\",\"CCL8\",\"IL18\",\"IL6\",\"TNF\")\npb_cluster &lt;- assays(pb)[[cluster]][goi,]\npb_cluster_cnames &lt;- str_replace_all(str_replace_all(colnames(pb_cluster),\"3rd_.{1,3}mgIpi_RNA\",\"\"),\"_Skin\",\"\")\ncolnames(pb_cluster) &lt;- pb_cluster_cnames\npb_cluster_cnames_sorted &lt;- pb_cluster_cnames[c(which(grepl(\"Pre\",pb_cluster_cnames)),which(grepl(\"Post\",pb_cluster_cnames)))]\n\n# Subset proportions table\ncluster_props &lt;- props %&gt;%\n  dplyr::filter(CellAnnotation == cluster_annot[cluster]) %&gt;%\n  dplyr::select(Sample,Proportion) %&gt;%\n  ungroup() %&gt;%\n  mutate(Sample = fct_relevel(as.factor(Sample),pb_cluster_cnames_sorted)) %&gt;%\n  dplyr::arrange(Sample) %&gt;%\n  as.data.frame()\n\n# Center expression around mean of Pre samples\npb_centered &lt;- controlCenter(pb_cluster[,pb_cluster_cnames_sorted], pattern_for_controls = \"Pre\", pattern_for_others = \"Post\")\n\n# Plot heatmap\ntimepoints &lt;- as.factor(str_split_i(pb_cluster_cnames_sorted,\"_\",2))\nha1 &lt;- HeatmapAnnotation(Timepoint = timepoints,\n                         show_legend = FALSE,\n                         col = list(Timepoint = setNames(c(\"lightgreen\", \"darkgreen\"), c(\"Pre\", \"Post\"))), \n                         border = TRUE)\nha2 &lt;- HeatmapAnnotation(Proportion = anno_barplot(round(cluster_props$Proportion,3), \n                                                   gp = gpar(fill = c(\n                                                      rep(\"lightgreen\",length(which(str_detect(cluster_props$Sample,\"Pre\")))), \n                                                      rep(\"darkgreen\",length(which(str_detect(cluster_props$Sample,\"Post\"))))\n                                                      )\n                                                     ),\n                                                   add_numbers = TRUE,\n                                                   numbers_rot = 0\n                                                   )\n                         )\n\np12 &lt;- ComplexHeatmap::Heatmap(pb_centered,\n                        cluster_rows = FALSE,\n                        cluster_columns = FALSE,\n                        column_split = factor(timepoints,levels = c(\"Pre\",\"Post\")),\n                        column_labels = str_replace_all(colnames(pb_centered),\"_Pre|_Post\",\"\"),\n                        row_names_gp = gpar(fontface = \"italic\",fontsize = 8),\n                        column_names_gp = gpar(fontsize = 8),\n                        col = colorRamp2(c(0,5),hcl_palette = \"viridis\"),\n                        border = TRUE,\n                        column_title = paste0(\"Cluster \", cluster, \": \", cluster_annot[cluster]),\n                        column_title_gp = gpar(fontface = \"bold\"),\n                        name = \"Expression relative to Pre\",\n                        top_annotation = c(ha1,ha2),\n                        show_heatmap_legend = FALSE\n) %&gt;% \n  draw() %&gt;% \n  grid.grabExpr()\n\nWarning: The input is a data frame-like object, convert it to a matrix.\n\n\n\n\n11.4.6 Cluster 15\n\n# Subset to genes of interest and reorder columns\ncluster &lt;- \"15\"\ngoi &lt;- c(\"CCL19\",\"CD40\",\"CD86\",\"CXCL9\")\npb_cluster &lt;- assays(pb)[[cluster]][goi,]\npb_cluster_cnames &lt;- str_replace_all(str_replace_all(colnames(pb_cluster),\"3rd_.{1,3}mgIpi_RNA\",\"\"),\"_Skin\",\"\")\ncolnames(pb_cluster) &lt;- pb_cluster_cnames\npb_cluster_cnames_sorted &lt;- pb_cluster_cnames[c(which(grepl(\"Pre\",pb_cluster_cnames)),which(grepl(\"Post\",pb_cluster_cnames)))]\n\n# Subset proportions table\ncluster_props &lt;- props %&gt;%\n  dplyr::filter(CellAnnotation == cluster_annot[cluster]) %&gt;%\n  dplyr::select(Sample,Proportion) %&gt;%\n  ungroup() %&gt;%\n  mutate(Sample = fct_relevel(as.factor(Sample),pb_cluster_cnames_sorted)) %&gt;%\n  dplyr::arrange(Sample) %&gt;%\n  as.data.frame()\n\n# Center expression around mean of Pre samples\npb_centered &lt;- controlCenter(pb_cluster[,pb_cluster_cnames_sorted], pattern_for_controls = \"Pre\", pattern_for_others = \"Post\")\n\n# Plot heatmap\ntimepoints &lt;- as.factor(str_split_i(pb_cluster_cnames_sorted,\"_\",2))\nha1 &lt;- HeatmapAnnotation(Timepoint = timepoints,\n                         show_legend = FALSE,\n                         col = list(Timepoint = setNames(c(\"lightgreen\", \"darkgreen\"), c(\"Pre\", \"Post\"))), \n                         border = TRUE)\nha2 &lt;- HeatmapAnnotation(Proportion = anno_barplot(round(cluster_props$Proportion,3), \n                                                   gp = gpar(fill = c(\n                                                      rep(\"lightgreen\",length(which(str_detect(cluster_props$Sample,\"Pre\")))), \n                                                      rep(\"darkgreen\",length(which(str_detect(cluster_props$Sample,\"Post\"))))\n                                                      )\n                                                     ),\n                                                   add_numbers = TRUE,\n                                                   numbers_rot = 0\n                                                   )\n                         )\n\np15 &lt;- ComplexHeatmap::Heatmap(pb_centered,\n                        cluster_rows = FALSE,\n                        cluster_columns = FALSE,\n                        column_split = factor(timepoints,levels = c(\"Pre\",\"Post\")),\n                        column_labels = str_replace_all(colnames(pb_centered),\"_Pre|_Post\",\"\"),\n                        row_names_gp = gpar(fontface = \"italic\",fontsize = 8),\n                        column_names_gp = gpar(fontsize = 8),\n                        col = colorRamp2(c(0,5),hcl_palette = \"viridis\"),\n                        border = TRUE,\n                        column_title = paste0(\"Cluster \", cluster, \": \",cluster_annot[cluster]),\n                        column_title_gp = gpar(fontface = \"bold\"),\n                        name = \"Expression relative to Pre\",\n                        top_annotation = c(ha1,ha2),\n                        show_heatmap_legend = FALSE\n) %&gt;% \n  draw() %&gt;% \n  grid.grabExpr()\n\nWarning: The input is a data frame-like object, convert it to a matrix.\n\n\n\n\n11.4.7 Cluster 5_2\n\n# Subset to genes of interest and reorder columns\ncluster &lt;- \"5_2\"\ngoi &lt;- c(\"GNLY\",\"GZMB\",\"PRF1\")\npb_cluster &lt;- assays(pb)[[cluster]][goi,]\npb_cluster_cnames &lt;- str_replace_all(str_replace_all(colnames(pb_cluster),\"3rd_.{1,3}mgIpi_RNA\",\"\"),\"_Skin\",\"\")\ncolnames(pb_cluster) &lt;- pb_cluster_cnames\npb_cluster_cnames_sorted &lt;- pb_cluster_cnames[c(which(grepl(\"Pre\",pb_cluster_cnames)),which(grepl(\"Post\",pb_cluster_cnames)))]\n\n# Subset proportions table\ncluster_props &lt;- props %&gt;%\n  dplyr::filter(CellAnnotation == cluster_annot[cluster]) %&gt;%\n  dplyr::select(Sample,Proportion) %&gt;%\n  ungroup() %&gt;%\n  mutate(Sample = fct_relevel(as.factor(Sample),pb_cluster_cnames_sorted)) %&gt;%\n  dplyr::arrange(Sample) %&gt;%\n  as.data.frame()\n\n# Center expression around mean of Pre samples\npb_centered &lt;- controlCenter(pb_cluster[,pb_cluster_cnames_sorted], pattern_for_controls = \"Pre\", pattern_for_others = \"Post\")\n\n# Plot heatmap\ntimepoints &lt;- as.factor(str_split_i(pb_cluster_cnames_sorted,\"_\",2))\nha1 &lt;- HeatmapAnnotation(Timepoint = timepoints,\n                         show_legend = FALSE,\n                         col = list(Timepoint = setNames(c(\"lightgreen\", \"darkgreen\"), c(\"Pre\", \"Post\"))), \n                         border = TRUE)\nha2 &lt;- HeatmapAnnotation(Proportion = anno_barplot(round(cluster_props$Proportion,3), \n                                                   gp = gpar(fill = c(\n                                                      rep(\"lightgreen\",length(which(str_detect(cluster_props$Sample,\"Pre\")))), \n                                                      rep(\"darkgreen\",length(which(str_detect(cluster_props$Sample,\"Post\"))))\n                                                      )\n                                                     ),\n                                                   add_numbers = TRUE,\n                                                   numbers_rot = 0\n                                                   )\n                         )\n\np5_2 &lt;- ComplexHeatmap::Heatmap(pb_centered,\n                        cluster_rows = FALSE,\n                        cluster_columns = FALSE,\n                        column_split = factor(timepoints,levels = c(\"Pre\",\"Post\")),\n                        column_labels = str_replace_all(colnames(pb_centered),\"_Pre|_Post\",\"\"),\n                        row_names_gp = gpar(fontface = \"italic\",fontsize = 8),\n                        column_names_gp = gpar(fontsize = 8),\n                        col = colorRamp2(c(0,5),hcl_palette = \"viridis\"),\n                        border = TRUE,\n                        column_title = paste0(\"Cluster \", cluster, \": \",cluster_annot[cluster]),\n                        column_title_gp = gpar(fontface = \"bold\"),\n                        name = \"Expression relative to Pre\",\n                        top_annotation = c(ha1,ha2),\n                        show_heatmap_legend = FALSE\n) %&gt;% \n  draw() %&gt;% \n  grid.grabExpr()\n\nWarning: The input is a data frame-like object, convert it to a matrix.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#assemble-final-figure",
    "href": "Skin_scRNA_Part10.html#assemble-final-figure",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "11.5 Assemble final figure",
    "text": "11.5 Assemble final figure\n\nwrap_plots(A = p0, \n           B = p12, \n           C = p15, \n           D = p5_2,\n           U = umap_circled,\n            design = \"C##A\n                      DUUB\n                      #UU#\")",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part10.html#get-session-info",
    "href": "Skin_scRNA_Part10.html#get-session-info",
    "title": "10  Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression",
    "section": "11.6 Get session info",
    "text": "11.6 Get session info\n\nsessionInfo()\n\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Rocky Linux 8.10 (Green Obsidian)\n\nMatrix products: default\nBLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.15.so;  LAPACK version 3.9.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: America/New_York\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats4    grid      stats     graphics  grDevices utils     datasets \n[8] methods   base     \n\nother attached packages:\n [1] knitr_1.45                  speckle_1.0.0              \n [3] cowplot_1.1.3               ggforce_0.4.2              \n [5] lemon_0.4.9                 scuttle_1.10.3             \n [7] limma_3.56.2                muscat_1.14.0              \n [9] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[11] Biobase_2.60.0              GenomicRanges_1.52.1       \n[13] GenomeInfoDb_1.36.4         IRanges_2.34.1             \n[15] S4Vectors_0.38.2            BiocGenerics_0.46.0        \n[17] MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[19] circlize_0.4.15             ComplexHeatmap_2.16.0      \n[21] msigdbr_7.5.1               paletteer_1.6.0            \n[23] patchwork_1.3.0             lubridate_1.9.3            \n[25] forcats_1.0.0               stringr_1.5.1              \n[27] dplyr_1.1.4                 purrr_1.0.2                \n[29] readr_2.1.5                 tidyr_1.3.1                \n[31] tibble_3.2.1                tidyverse_2.0.0            \n[33] Seurat_5.1.0                SeuratObject_5.0.2         \n[35] sp_2.1-3                    ggplot2_3.5.1              \n[37] presto_1.0.0                data.table_1.15.0          \n[39] Rcpp_1.0.12                \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] doParallel_1.0.17         numDeriv_2016.8-1.1      \n  [7] backports_1.4.1           tools_4.3.1              \n  [9] sctransform_0.4.1         utf8_1.2.4               \n [11] R6_2.5.1                  lazyeval_0.2.2           \n [13] uwot_0.1.16               mgcv_1.9-1               \n [15] GetoptLong_1.0.5          withr_3.0.0              \n [17] prettyunits_1.2.0         gridExtra_2.3            \n [19] SeuratWrappers_0.3.19     progressr_0.14.0         \n [21] cli_3.6.2                 Cairo_1.6-2              \n [23] spatstat.explore_3.2-6    fastDummies_1.7.3        \n [25] sandwich_3.1-0            labeling_0.4.3           \n [27] mvtnorm_1.2-4             spatstat.data_3.0-4      \n [29] blme_1.0-5                ggridges_0.5.6           \n [31] pbapply_1.7-2             R.utils_2.12.3           \n [33] scater_1.28.0             parallelly_1.37.0        \n [35] generics_0.1.3            shape_1.4.6              \n [37] gtools_3.9.5              ica_1.0-3                \n [39] spatstat.random_3.2-2     Matrix_1.6-4             \n [41] ggbeeswarm_0.7.2          fansi_1.0.6              \n [43] abind_1.4-5               R.methodsS3_1.8.2        \n [45] lifecycle_1.0.4           multcomp_1.4-25          \n [47] yaml_2.3.8                edgeR_3.42.4             \n [49] gplots_3.1.3.1            Rtsne_0.17               \n [51] promises_1.2.1            crayon_1.5.2             \n [53] miniUI_0.1.1.1            lattice_0.22-5           \n [55] beachmat_2.16.0           magick_2.8.3             \n [57] pillar_1.9.0              rjson_0.2.21             \n [59] boot_1.3-29               estimability_1.4.1       \n [61] future.apply_1.11.1       codetools_0.2-19         \n [63] leiden_0.4.3.1            glue_1.7.0               \n [65] remotes_2.4.2.1           vctrs_0.6.5              \n [67] png_0.1-8                 spam_2.10-0              \n [69] Rdpack_2.6                gtable_0.3.4             \n [71] rematch2_2.1.2            xfun_0.42                \n [73] rbibutils_2.2.16          S4Arrays_1.2.0           \n [75] mime_0.12                 coda_0.19-4.1            \n [77] reformulas_0.4.0          survival_3.5-8           \n [79] iterators_1.0.14          statmod_1.5.0            \n [81] ellipsis_0.3.2            fitdistrplus_1.1-11      \n [83] TH.data_1.1-2             ROCR_1.0-11              \n [85] nlme_3.1-164              pbkrtest_0.5.2           \n [87] EnvStats_2.8.1            progress_1.2.3           \n [89] RcppAnnoy_0.0.22          TMB_1.9.10               \n [91] irlba_2.3.5.1             vipor_0.4.7              \n [93] KernSmooth_2.23-22        colorspace_2.1-0         \n [95] nnet_7.3-19               DESeq2_1.40.2            \n [97] tidyselect_1.2.0          emmeans_1.10.0           \n [99] compiler_4.3.1            BiocNeighbors_1.18.0     \n[101] DelayedArray_0.26.7       plotly_4.10.4            \n[103] caTools_1.18.2            scales_1.3.0             \n[105] remaCor_0.0.18            lmtest_0.9-40            \n[107] digest_0.6.34             goftest_1.2-3            \n[109] spatstat.utils_3.0-4      minqa_1.2.6              \n[111] variancePartition_1.30.2  rmarkdown_2.25           \n[113] aod_1.3.3                 RhpcBLASctl_0.23-42      \n[115] XVector_0.40.0            htmltools_0.5.7          \n[117] pkgconfig_2.0.3           lme4_1.1-35.1            \n[119] sparseMatrixStats_1.12.2  highr_0.10               \n[121] fastmap_1.1.1             rlang_1.1.3              \n[123] GlobalOptions_0.1.2       htmlwidgets_1.6.4        \n[125] shiny_1.8.0               DelayedMatrixStats_1.22.6\n[127] farver_2.1.1              zoo_1.8-12               \n[129] jsonlite_1.8.8            BiocParallel_1.34.2      \n[131] R.oo_1.26.0               BiocSingular_1.16.0      \n[133] RCurl_1.98-1.14           magrittr_2.0.3           \n[135] modeltools_0.2-23         GenomeInfoDbData_1.2.10  \n[137] dotCall64_1.1-1           munsell_0.5.0            \n[139] viridis_0.6.5             babelgene_22.9           \n[141] reticulate_1.35.0         stringi_1.8.3            \n[143] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[145] flexmix_2.3-19            plyr_1.8.9               \n[147] parallel_4.3.1            listenv_0.9.1            \n[149] ggrepel_0.9.5             deldir_2.0-2             \n[151] splines_4.3.1             tensor_1.5               \n[153] hms_1.1.3                 locfit_1.5-9.8           \n[155] igraph_2.0.2              spatstat.geom_3.2-8      \n[157] RcppHNSW_0.6.0            ScaledMatrix_1.8.1       \n[159] reshape2_1.4.4            evaluate_0.23            \n[161] BiocManager_1.30.22       tweenr_2.0.2             \n[163] nloptr_2.0.3              tzdb_0.4.0               \n[165] foreach_1.5.2             httpuv_1.6.14            \n[167] RANN_2.6.1                polyclip_1.10-6          \n[169] future_1.33.1             clue_0.3-65              \n[171] scattermore_1.2           rsvd_1.0.5               \n[173] broom_1.0.5               xtable_1.8-4             \n[175] RSpectra_0.16-1           later_1.3.2              \n[177] viridisLite_0.4.2         lmerTest_3.1-3           \n[179] glmmTMB_1.1.10            beeswarm_0.4.0           \n[181] cluster_2.1.6             timechange_0.3.0         \n[183] globals_0.16.2",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Skin: Deep phenotyping, cluster annotation, and exploration of Post vs Pre 3rd vaccination differences in cell proportions and expression</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html",
    "href": "Skin_scRNA_Part11.html",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "",
    "text": "11.1 Set up Seurat workspace\n# Load libraries\nlibrary(ggplot2)\nlibrary(Seurat)\nlibrary(tidyverse)\nlibrary(msigdbr)\nlibrary(fgsea)\nlibrary(GSEAtraining)       # This is used because KEGG_MEDICUS isn't yet available in msigdbr",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#read-in-pseudobulk-de-test-results",
    "href": "Skin_scRNA_Part11.html#read-in-pseudobulk-de-test-results",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.2 Read in pseudobulk DE test results",
    "text": "11.2 Read in pseudobulk DE test results\n\nskin_de &lt;- read_tsv(\"Skin_scRNA_PostVsPre3rd_DiffExp_results.tsv\")\n\nRows: 125307 Columns: 11\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (4): sub.cluster, gene, cluster_id, contrast\ndbl (7): baseMean, logFC, lfcSE, stat, p_val, p_adj.loc, p_adj.glb\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nskin_de\n\n# A tibble: 125,307 × 11\n   sub.cluster gene   cluster_id baseMean   logFC lfcSE   stat   p_val p_adj.loc\n   &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;\n 1 0           7SK    0            166.   -2.09   0.470 -4.44  9.12e-6  0.000168\n 2 0           A2M    0             84.8  -3.11   1.07  -2.90  3.75e-3  0.0215  \n 3 0           AAGAB  0             21.1   0.113  0.282  0.400 6.89e-1  0.817   \n 4 0           AAK1   0            105.   -0.111  0.154 -0.724 4.69e-1  0.650   \n 5 0           AAMDC  0             22.9   0.303  0.280  1.08  2.79e-1  0.471   \n 6 0           AAMP   0             50.9   0.0513 0.219  0.234 8.15e-1  0.897   \n 7 0           AAR2   0              9.66  0.0439 0.430  0.102 9.19e-1  0.959   \n 8 0           AARS1  0             12.1  -0.160  0.327 -0.489 6.25e-1  0.773   \n 9 0           AASDH… 0             14.8   0.495  0.315  1.57  1.16e-1  0.262   \n10 0           AATF   0             50.2   0.489  0.233  2.10  3.58e-2  0.116   \n# ℹ 125,297 more rows\n# ℹ 2 more variables: p_adj.glb &lt;dbl&gt;, contrast &lt;chr&gt;",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#set-cluster-annotations",
    "href": "Skin_scRNA_Part11.html#set-cluster-annotations",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.3 Set cluster annotations",
    "text": "11.3 Set cluster annotations\n\ncluster_annot &lt;- c(\n        \"0\" = \"MonoMac_1\",\n        \"1_0\" = \"CD4_T_Naive/CM\",\n        \"1_1\" = \"CD4_T_CTL\",\n        \"2_0\" = \"CD8_T_EM_1\",\n        \"2_1\" = \"CD8_T_Naive/CM_1\",\n        \"2_2\" = \"CD8_T_EM_2\",\n        \"3\" = \"MonoMac_2\",\n        \"4_0\" = \"CD8_T_Naive/CM_2\",\n        \"4_1\" = \"CD8_T_Naive/CM_3\",\n        \"5_0\" = \"NK/T_1\",\n        \"5_1\" = \"NK/T_2\",\n        \"5_2\" = \"NK_cells\",\n        \"6_0\" = \"T_unknown_1\",\n        \"6_1\" = \"CD8_T_EM_3\",\n        \"7\" = \"cDC2\",\n        \"8\" = \"Keratinocytes\",\n        \"9_0\" = \"Treg_1\",\n        \"9_1\" = \"Treg_2\",\n        \"10\" = \"Fibroblasts\",\n        \"11_0\" = \"T_unknown_2\",\n        \"11_1\" = \"T_unknown_3\",\n        \"12\" = \"MonoMac_3\",\n        \"13_0\" = \"Proliferating_T_cells_1\",\n        \"13_1\" = \"Proliferating_T_cells_2\",\n        \"14\" = \"pDC\",\n        \"15\" = \"DC_LAMP3\",\n        \"16\" = \"Mast\",\n        \"17\" = \"Endothelial\",\n        \"18\" = \"cDC1\",\n        \"19_0\" = \"NK/T_3\",\n        \"20\" = \"Pericytes/smooth_muscle\",\n        \"21\" = \"Basal_1\",\n        \"22\" = \"MonoMac_4\",\n        \"23\" = \"B_cells\",\n        \"24\" = \"Basal_2\",\n        \"25\" = \"Macrophages\",\n        \"26\" = \"Proliferating_cDC2\"\n)",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#set-cluster-orders-for-plotting",
    "href": "Skin_scRNA_Part11.html#set-cluster-orders-for-plotting",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.4 Set cluster orders for plotting",
    "text": "11.4 Set cluster orders for plotting\n\ncluster_order &lt;- c(\"0\",\"3\",\"12\",\"22\",\"25\",\"14\",\"18\",\"7\",\"26\",\"15\",\"23\",\"5_2\",\"5_0\",\"5_1\",\"19_0\",\"2_1\",\"4_0\",\"4_1\",\"2_0\",\"2_2\",\"6_1\",\"1_0\",\"1_1\",\"9_0\",\"9_1\",\"13_0\",\"13_1\",\"6_0\",\"11_0\",\"11_1\",\"16\",\"8\",\"10\",\"17\",\"20\",\"21\",\"24\")",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#split-results-by-cluster-then-extract-ranks-by-log2-fold-change-post3rd-vs-pre3rd",
    "href": "Skin_scRNA_Part11.html#split-results-by-cluster-then-extract-ranks-by-log2-fold-change-post3rd-vs-pre3rd",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.5 Split results by cluster, then extract ranks by log2 fold-change Post3rd vs Pre3rd",
    "text": "11.5 Split results by cluster, then extract ranks by log2 fold-change Post3rd vs Pre3rd\n\nskin_de_split &lt;- skin_de %&gt;%\n    group_by(sub.cluster) %&gt;%\n    group_split()\n\nskin_de_split_ranks &lt;- lapply(skin_de_split, \n                                FUN = function(x) { x %&gt;%\n                                    dplyr::select(gene,logFC) %&gt;%\n                                    dplyr::arrange(logFC) %&gt;%\n                                    deframe()\n                                    }\n                        )\nnames(skin_de_split_ranks) &lt;- paste0(\"Cluster\", \n                                sapply(skin_de_split, \n                                FUN = function(x) { x %&gt;% \n                                    pull(sub.cluster) %&gt;%\n                                    unique()\n                                    }\n                                )\n                            )",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#prepare-gene-sets-from-msigdb",
    "href": "Skin_scRNA_Part11.html#prepare-gene-sets-from-msigdb",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.6 Prepare gene sets from MSigDB",
    "text": "11.6 Prepare gene sets from MSigDB\n\nc2 &lt;- msigdbr::msigdbr(species=\"Homo sapiens\",\n        category = \"C2\")\n\nimmunesig &lt;- msigdbr::msigdbr(species=\"Homo sapiens\",\n        category = \"C7\", \n        subcategory = \"IMMUNESIGDB\")\n\nhallmark &lt;- msigdbr::msigdbr(species=\"Homo sapiens\",\n    category = \"H\")                         \n\n# Get updated KEGG MEDICUS collection from GSEAtraining package \nkm &lt;- get_msigdb(version = \"2024.1.Hs\", \n    collection = \"c2.cp.kegg_medicus\",\n    gene_id_type = \"symbols\")\n\n# Combine into named list\npathwaysToTest &lt;- bind_rows(c2, immunesig, hallmark)\n\npathwaysToTest_split &lt;- pathwaysToTest %&gt;%\n    dplyr::select(gs_name,human_gene_symbol) %&gt;%\n    group_by(gs_name) %&gt;%\n    group_split()\n\nnames(pathwaysToTest_split) &lt;- sapply(pathwaysToTest_split, \n                                        FUN = function(x) { x %&gt;% \n                                            pull(gs_name) %&gt;%\n                                            unique()\n                                            }\n                                        )\n\n\npathwaysToTest_split_list &lt;- sapply(pathwaysToTest_split, \n                                    simplify = FALSE, \n                                    USE.NAMES = TRUE, \n                                    FUN = function(x) { x %&gt;%\n                                        pull(human_gene_symbol) %&gt;%\n                                        unique()\n                                    }\n                                )\n# Add KEGG MEDICUS to the list\npathwaysToTest_split_list &lt;- c(pathwaysToTest_split_list, km)",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#iterate-over-de-results-and-run-fgsea-on-each-clusters-ranked-gene-list",
    "href": "Skin_scRNA_Part11.html#iterate-over-de-results-and-run-fgsea-on-each-clusters-ranked-gene-list",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.7 Iterate over DE results and run fgsea on each cluster’s ranked gene list",
    "text": "11.7 Iterate over DE results and run fgsea on each cluster’s ranked gene list\n\nset.seed(123)\nfgseaRes &lt;- sapply(skin_de_split_ranks, \n    simplify = FALSE, \n    USE.NAMES = TRUE, \n    FUN = function(x) {\n        fgsea(pathways = pathwaysToTest_split_list, \n              stats = x,\n              minSize = 5, # Note this is the intersection of genes in the ranked list and genes in the pathway\n              maxSize = 1000,\n              nproc = 1\n              )\n        }\n    )",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#collapse-all-results-into-one-tibble-and-filter-for-significance",
    "href": "Skin_scRNA_Part11.html#collapse-all-results-into-one-tibble-and-filter-for-significance",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.8 Collapse all results into one tibble and filter for significance",
    "text": "11.8 Collapse all results into one tibble and filter for significance\nSave the filtered output\n\nbind_rows(fgseaRes,.id = \"sub.cluster\") %&gt;%\n    as_tibble() %&gt;%\n    mutate(leadingEdgeGenes = map_chr(leadingEdge, toString)) %&gt;%\n    dplyr::select(-leadingEdge) %&gt;%\n    dplyr::filter(padj &lt; 0.05) %&gt;%\n    dplyr::arrange(sub.cluster,padj,NES) %&gt;%\n    write_tsv(\"Skin_scRNA_PostVsPre3rd_DiffExp_fgseaRes_sig.tsv\")",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#print-selection-of-top-most-significant-pathways",
    "href": "Skin_scRNA_Part11.html#print-selection-of-top-most-significant-pathways",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.9 Print selection of top-most significant pathways",
    "text": "11.9 Print selection of top-most significant pathways\n\nbind_rows(fgseaRes,.id = \"sub.cluster\") %&gt;%\n    as_tibble() %&gt;%\n    mutate(leadingEdgeGenes = map_chr(leadingEdge, toString)) %&gt;%\n    dplyr::select(-leadingEdge) %&gt;%\n    dplyr::filter(padj &lt; 0.05) %&gt;%\n    dplyr::arrange(sub.cluster,padj,-NES) %&gt;%\n    group_by(sub.cluster) %&gt;%\n    slice_head(n = 10) %&gt;%\n    pull(pathway) %&gt;%\n    unique()\n\n [1] \"GSE42724_NAIVE_BCELL_VS_PLASMABLAST_UP\"                                 \n [2] \"GSE13485_DAY3_VS_DAY7_YF17D_VACCINE_PBMC_DN\"                            \n [3] \"GSE13484_UNSTIM_VS_YF17D_VACCINE_STIM_PBMC_DN\"                          \n [4] \"GSE13485_CTRL_VS_DAY7_YF17D_VACCINE_PBMC_DN\"                            \n [5] \"GSE18791_UNSTIM_VS_NEWCATSLE_VIRUS_DC_6H_DN\"                            \n [6] \"GSE18791_CTRL_VS_NEWCASTLE_VIRUS_DC_8H_DN\"                              \n [7] \"GSE37533_PPARG1_FOXP3_VS_FOXP3_TRANSDUCED_CD4_TCELL_DN\"                 \n [8] \"GSE42021_TREG_VS_TCONV_PLN_UP\"                                          \n [9] \"BLANCO_MELO_BRONCHIAL_EPITHELIAL_CELLS_INFLUENZA_A_DEL_NS1_INFECTION_UP\"\n[10] \"GSE2770_TGFB_AND_IL4_ACT_VS_ACT_CD4_TCELL_2H_DN\"                        \n[11] \"HALLMARK_INTERFERON_GAMMA_RESPONSE\"                                     \n[12] \"GSE37533_PPARG2_FOXP3_VS_FOXP3_TRANSDUCED_CD4_TCELL_DN\"                 \n[13] \"GSE21546_WT_VS_SAP1A_KO_DP_THYMOCYTES_UP\"                               \n[14] \"GSE42021_CD24HI_VS_CD24INT_TREG_THYMUS_DN\"                              \n[15] \"GSE42021_TREG_PLN_VS_TREG_PRECURSORS_THYMUS_DN\"                         \n[16] \"GSE13485_CTRL_VS_DAY3_YF17D_VACCINE_PBMC_DN\"                            \n[17] \"GSE42021_TREG_PLN_VS_CD24LO_TREG_THYMUS_DN\"                             \n[18] \"GSE13485_PRE_VS_POST_YF17D_VACCINATION_PBMC_DN\"                         \n[19] \"TAKEDA_TARGETS_OF_NUP98_HOXA9_FUSION_3D_UP\"                             \n[20] \"GSE13485_DAY1_VS_DAY7_YF17D_VACCINE_PBMC_DN\"                            \n[21] \"GSE21927_SPLEEN_C57BL6_VS_4T1_TUMOR_BALBC_MONOCYTES_DN\"                 \n[22] \"HECKER_IFNB1_TARGETS\"                                                   \n[23] \"REACTOME_EUKARYOTIC_TRANSLATION_ELONGATION\"                             \n[24] \"KEGG_MEDICUS_REFERENCE_TRANSLATION_INITIATION\"                          \n[25] \"BILANGES_SERUM_AND_RAPAMYCIN_SENSITIVE_GENES\"                           \n[26] \"REACTOME_EUKARYOTIC_TRANSLATION_INITIATION\"                             \n[27] \"KEGG_RIBOSOME\"                                                          \n[28] \"GSE42021_TREG_PLN_VS_CD24INT_TREG_THYMUS_DN\"                            \n[29] \"REACTOME_INTERFERON_SIGNALING\"                                          \n[30] \"GSE21546_ELK1_KO_VS_SAP1A_KO_AND_ELK1_KO_DP_THYMOCYTES_UP\"              \n[31] \"WP_CYTOPLASMIC_RIBOSOMAL_PROTEINS\"                                      \n[32] \"REACTOME_SELENOAMINO_ACID_METABOLISM\"                                   \n[33] \"GSE6269_FLU_VS_STREP_PNEUMO_INF_PBMC_UP\"                                \n[34] \"REACTOME_TRANSLATION\"                                                   \n[35] \"BLANCO_MELO_HUMAN_PARAINFLUENZA_VIRUS_3_INFECTION_A594_CELLS_UP\"        \n[36] \"REACTOME_SRP_DEPENDENT_COTRANSLATIONAL_PROTEIN_TARGETING_TO_MEMBRANE\"   \n[37] \"REACTOME_RRNA_PROCESSING\"                                               \n[38] \"REACTOME_NONSENSE_MEDIATED_DECAY_NMD\"                                   \n[39] \"DACOSTA_UV_RESPONSE_VIA_ERCC3_DN\"",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#print-selection-of-recurring-top-most-significant-pathways-in-multiple-clusters",
    "href": "Skin_scRNA_Part11.html#print-selection-of-recurring-top-most-significant-pathways-in-multiple-clusters",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.10 Print selection of recurring top-most significant pathways in multiple clusters",
    "text": "11.10 Print selection of recurring top-most significant pathways in multiple clusters\nRestrict to HALLMARK, KEGG, WP, or REACTOME pathways seen in the top 100 most significant results in at least 2 clusters\n\nrecurring_topSigPathways &lt;- bind_rows(fgseaRes,.id = \"sub.cluster\") %&gt;%\n    as_tibble() %&gt;%\n    mutate(leadingEdgeGenes = map_chr(leadingEdge, toString)) %&gt;%\n    dplyr::select(-leadingEdge) %&gt;%\n    dplyr::filter(padj &lt; 0.05 & NES &gt; 0) %&gt;%\n    dplyr::arrange(sub.cluster,padj) %&gt;%\n    group_by(sub.cluster) %&gt;%\n    slice_head(n = 100) %&gt;%\n    dplyr::select(sub.cluster,pathway,padj,NES) %&gt;%\n    group_by(pathway) %&gt;%\n    summarize(n = n()) %&gt;%\n    dplyr::filter(n&gt;=2) %&gt;%\n    dplyr::filter(str_detect(pathway,\"HALLMARK|WP|KEGG|REACTOME\")) %&gt;% \n    pull(pathway) %&gt;%\n    unique()\n\nrecurring_topSigPathways\n\n[1] \"HALLMARK_INTERFERON_ALPHA_RESPONSE\"          \n[2] \"HALLMARK_INTERFERON_GAMMA_RESPONSE\"          \n[3] \"REACTOME_ADAPTIVE_IMMUNE_SYSTEM\"             \n[4] \"REACTOME_CYTOKINE_SIGNALING_IN_IMMUNE_SYSTEM\"\n[5] \"REACTOME_INTERFERON_ALPHA_BETA_SIGNALING\"    \n[6] \"REACTOME_INTERFERON_SIGNALING\"               \n[7] \"WP_PROTEASOME_DEGRADATION\"                   \n\nnames(recurring_topSigPathways) &lt;- rep(\"Other recurring significant\",length(recurring_topSigPathways))",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#filter-to-specific-pathways-related-to-innate-immunity-of-interest",
    "href": "Skin_scRNA_Part11.html#filter-to-specific-pathways-related-to-innate-immunity-of-interest",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.11 Filter to specific pathways related to innate immunity of interest",
    "text": "11.11 Filter to specific pathways related to innate immunity of interest\n\ntopsigPathways &lt;- c(\"Innate stimulation\" = \"KEGG_TOLL_LIKE_RECEPTOR_SIGNALING_PATHWAY\",\n                            \"Interferon signaling\" = \"REACTOME_INTERFERON_SIGNALING\",\n                            \"Interferon signaling\" = \"REACTOME_INTERFERON_ALPHA_BETA_SIGNALING\",\n                            \"Interferon signaling\" = \"HALLMARK_INTERFERON_ALPHA_RESPONSE\",\n                            \"Interferon signaling\" = \"HALLMARK_INTERFERON_GAMMA_RESPONSE\",\n                            \"Cytokine signaling\" = \"REACTOME_CYTOKINE_SIGNALING_IN_IMMUNE_SYSTEM\",\n                            \"Cytokine signaling\" = \"REACTOME_SIGNALING_BY_INTERLEUKINS\",\n                            \"Cytokine signaling\" = \"REACTOME_INTERLEUKIN_1_FAMILY_SIGNALING\",\n                            \"Cytokine signaling\" = \"REACTOME_INTERLEUKIN_2_FAMILY_SIGNALING\",\n                            \"Cytokine signaling\" = \"HALLMARK_IL2_STAT5_SIGNALING\",\n                            \"Cytokine signaling\" = \"HALLMARK_IL6_JAK_STAT3_SIGNALING\",\n                            \"Cytokine signaling\" = \"HALLMARK_TNFA_SIGNALING_VIA_NFKB\",\n                            \"Antigen processing\" = \"REACTOME_ANTIGEN_PROCESSING_CROSS_PRESENTATION\",\n                            \"Antigen processing\" = \"REACTOME_ANTIGEN_PROCESSING_UBIQUITINATION_PROTEASOME_DEGRADATION\"\n                )\n\n# Combine with top significant and remove redundant pathways\ntopsigPathways &lt;- c(topsigPathways,recurring_topSigPathways[!recurring_topSigPathways %in% topsigPathways])\n    \ngs_pathways &lt;- pathwaysToTest_split_list[topsigPathways]",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#plot-dot-plot-of-nes-and-p-value-for-pathways-of-interest",
    "href": "Skin_scRNA_Part11.html#plot-dot-plot-of-nes-and-p-value-for-pathways-of-interest",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.12 Plot dot plot of NES and p-value for pathways of interest",
    "text": "11.12 Plot dot plot of NES and p-value for pathways of interest\n\nbind_rows(fgseaRes,.id = \"sub.cluster\") %&gt;%\n    as_tibble() %&gt;%\n    mutate(leadingEdgeGenes = map_chr(leadingEdge, toString)) %&gt;%\n    dplyr::select(-leadingEdge) %&gt;%\n    dplyr::filter(pathway %in% topsigPathways) %&gt;%\n    left_join(enframe(topsigPathways,name = \"PathwayGroup\",value = \"pathway\"),by=\"pathway\") %&gt;%\n    left_join(enframe(cluster_annot,name = \"sub.cluster\", value = \"Cluster\") %&gt;% \n                mutate(sub.cluster = paste0(\"Cluster\",sub.cluster)), \n              by = \"sub.cluster\") %&gt;%\n    mutate(logP = ifelse(padj &lt; 0.05, -log10(padj), 0)) %&gt;%\n    ggplot(aes(x = fct_relevel(Cluster,cluster_annot[cluster_order][cluster_annot[cluster_order] %in% Cluster]), y = pathway)) +\n    geom_point(aes(color = NES, size = logP, alpha = I(ifelse(logP &lt; -log10(0.05), 0, 1)))) +\n    scale_size_continuous(\"-log10 adj p\", range = c(1, 10), breaks = c(1.3, 5, 10, 20, 30)) +\n    scale_color_gradient2(low = \"blue\", mid = \"white\", high = \"red\", limits=c(-3,3), midpoint = 0, oob = scales::squish) +\n    theme_bw() +\n    facet_grid(fct_relevel(PathwayGroup,\n                            c(\"Innate stimulation\",\n                              \"Interferon signaling\",\n                              \"Cytokine signaling\",\n                              \"Antigen processing\",\n                              \"Other recurring significant\")\n                           )~.,\n               scales=\"free\",\n               switch=\"y\",\n               space=\"free\") +\n    scale_y_discrete(position = \"right\") +\n    ylab(\"\") +\n    xlab(\"\") +\n    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),\n          strip.text.y.left = element_text(angle = 0))",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  },
  {
    "objectID": "Skin_scRNA_Part11.html#get-session-info",
    "href": "Skin_scRNA_Part11.html#get-session-info",
    "title": "11  Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea",
    "section": "11.13 Get session info",
    "text": "11.13 Get session info\n\nsessionInfo()\n\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Rocky Linux 8.10 (Green Obsidian)\n\nMatrix products: default\nBLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.15.so;  LAPACK version 3.9.0\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\ntime zone: America/New_York\ntzcode source: system (glibc)\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] GSEAtraining_0.99.1 fgsea_1.26.0        msigdbr_7.5.1      \n [4] lubridate_1.9.3     forcats_1.0.0       stringr_1.5.1      \n [7] dplyr_1.1.4         purrr_1.0.2         readr_2.1.5        \n[10] tidyr_1.3.1         tibble_3.2.1        tidyverse_2.0.0    \n[13] Seurat_5.1.0        SeuratObject_5.0.2  sp_2.1-3           \n[16] ggplot2_3.5.1      \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      jsonlite_1.8.8          magrittr_2.0.3         \n  [4] spatstat.utils_3.0-4    farver_2.1.1            rmarkdown_2.25         \n  [7] zlibbioc_1.46.0         vctrs_0.6.5             ROCR_1.0-11            \n [10] memoise_2.0.1           spatstat.explore_3.2-6  RCurl_1.98-1.14        \n [13] htmltools_0.5.7         sctransform_0.4.1       parallelly_1.37.0      \n [16] KernSmooth_2.23-22      htmlwidgets_1.6.4       ica_1.0-3              \n [19] plyr_1.8.9              cachem_1.0.8            plotly_4.10.4          \n [22] zoo_1.8-12              igraph_2.0.2            mime_0.12              \n [25] lifecycle_1.0.4         pkgconfig_2.0.3         Matrix_1.6-4           \n [28] R6_2.5.1                fastmap_1.1.1           GenomeInfoDbData_1.2.10\n [31] fitdistrplus_1.1-11     future_1.33.1           shiny_1.8.0            \n [34] digest_0.6.34           colorspace_2.1-0        S4Vectors_0.38.2       \n [37] AnnotationDbi_1.64.1    patchwork_1.3.0         tensor_1.5             \n [40] RSpectra_0.16-1         irlba_2.3.5.1           RSQLite_2.3.5          \n [43] labeling_0.4.3          progressr_0.14.0        fansi_1.0.6            \n [46] spatstat.sparse_3.0-3   timechange_0.3.0        httr_1.4.7             \n [49] polyclip_1.10-6         abind_1.4-5             compiler_4.3.1         \n [52] bit64_4.0.5             withr_3.0.0             BiocParallel_1.34.2    \n [55] DBI_1.2.2               fastDummies_1.7.3       MASS_7.3-60.0.1        \n [58] tools_4.3.1             lmtest_0.9-40           httpuv_1.6.14          \n [61] future.apply_1.11.1     goftest_1.2-3           glue_1.7.0             \n [64] nlme_3.1-164            promises_1.2.1          grid_4.3.1             \n [67] Rtsne_0.17              cluster_2.1.6           reshape2_1.4.4         \n [70] generics_0.1.3          gtable_0.3.4            spatstat.data_3.0-4    \n [73] tzdb_0.4.0              data.table_1.15.0       hms_1.1.3              \n [76] XVector_0.40.0          utf8_1.2.4              BiocGenerics_0.46.0    \n [79] spatstat.geom_3.2-8     RcppAnnoy_0.0.22        ggrepel_0.9.5          \n [82] RANN_2.6.1              pillar_1.9.0            vroom_1.6.5            \n [85] spam_2.10-0             babelgene_22.9          RcppHNSW_0.6.0         \n [88] later_1.3.2             splines_4.3.1           lattice_0.22-5         \n [91] bit_4.0.5               survival_3.5-8          deldir_2.0-2           \n [94] tidyselect_1.2.0        Biostrings_2.68.1       miniUI_0.1.1.1         \n [97] pbapply_1.7-2           knitr_1.45              gridExtra_2.3          \n[100] IRanges_2.34.1          scattermore_1.2         stats4_4.3.1           \n[103] xfun_0.42               Biobase_2.60.0          matrixStats_1.2.0      \n[106] DT_0.31                 stringi_1.8.3           lazyeval_0.2.2         \n[109] yaml_2.3.8              evaluate_0.23           codetools_0.2-19       \n[112] cli_3.6.2               uwot_0.1.16             xtable_1.8-4           \n[115] reticulate_1.35.0       munsell_0.5.0           GenomeInfoDb_1.36.4    \n[118] Rcpp_1.0.12             globals_0.16.2          spatstat.random_3.2-2  \n[121] png_0.1-8               parallel_4.3.1          ellipsis_0.3.2         \n[124] blob_1.2.4              dotCall64_1.1-1         bitops_1.0-7           \n[127] listenv_0.9.1           viridisLite_0.4.2       scales_1.3.0           \n[130] ggridges_0.5.6          crayon_1.5.2            leiden_0.4.3.1         \n[133] rlang_1.1.3             KEGGREST_1.40.1         fastmatch_1.1-4        \n[136] cowplot_1.1.3",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Skin: Calculating Post vs Pre 3rd vaccination differences in pathway enrichments with fgsea</span>"
    ]
  }
]